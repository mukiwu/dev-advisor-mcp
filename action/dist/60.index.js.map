{"version":3,"file":"60.index.js","mappings":";;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sources":[".././action/commenter.js"],"sourcesContent":["\n/**\n * GitHub PR è©•è«–å·¥å…·\n * ä½¿ç”¨ GitHub API åœ¨ PR ä¸­ç™¼é€è©•è«–\n */\n\nimport * as github from '@actions/github';\nimport * as core from '@actions/core';\n\nconst MAX_COMMENT_LENGTH = 65500; // GitHub è©•è«–é™åˆ¶ç´„ 65536 å­—å…ƒï¼Œç•™ä¸€äº›ç·©è¡\n\n/**\n * ç™¼é€æˆ–æ›´æ–° PR è©•è«–\n */\nexport async function commentOnPR(token, report, commentOnPR = true) {\n  if (!commentOnPR) {\n    core.info('comment-on-pr è¨­ç‚º falseï¼Œè·³é PR è©•è«–');\n    return null;\n  }\n\n  const octokit = github.getOctokit(token);\n  const context = github.context;\n\n  // æª¢æŸ¥æ˜¯å¦åœ¨ PR ç’°å¢ƒä¸­\n  if (context.eventName !== 'pull_request') {\n    core.warning('æ­¤ action åªèƒ½åœ¨ pull_request äº‹ä»¶ä¸­ä½¿ç”¨');\n    return null;\n  }\n\n  const owner = context.repo.owner;\n  const repo = context.repo.repo;\n  const prNumber = context.payload.pull_request?.number;\n\n  if (!prNumber) {\n    core.warning('ç„¡æ³•å–å¾— PR ç·¨è™Ÿ');\n    return null;\n  }\n\n  try {\n    // æŸ¥æ‰¾ç¾æœ‰çš„è©•è«–ï¼ˆç”± bot ç™¼é€ï¼‰\n    const existingComment = await findExistingComment(octokit, owner, repo, prNumber);\n\n    // å¦‚æœå ±å‘Šå¤ªé•·ï¼Œåˆ†æ®µè™•ç†\n    const commentBody = formatCommentBody(report);\n\n    if (existingComment) {\n      // æ›´æ–°ç¾æœ‰è©•è«–\n      await octokit.rest.issues.updateComment({\n        owner,\n        repo,\n        comment_id: existingComment.id,\n        body: commentBody\n      });\n      core.info(`å·²æ›´æ–° PR #${prNumber} çš„è©•è«–`);\n      return existingComment.id;\n    } else {\n      // å‰µå»ºæ–°è©•è«–\n      const { data } = await octokit.rest.issues.createComment({\n        owner,\n        repo,\n        issue_number: prNumber,\n        body: commentBody\n      });\n      core.info(`å·²åœ¨ PR #${prNumber} ä¸­å‰µå»ºè©•è«–`);\n      return data.id;\n    }\n  } catch (error) {\n    core.error(`ç™¼é€ PR è©•è«–å¤±æ•—: ${error instanceof Error ? error.message : String(error)}`);\n    throw error;\n  }\n}\n\n/**\n * æŸ¥æ‰¾ç¾æœ‰çš„è©•è«–\n */\nasync function findExistingComment(octokit, owner, repo, prNumber) {\n  try {\n    const { data: comments } = await octokit.rest.issues.listComments({\n      owner,\n      repo,\n      issue_number: prNumber\n    });\n\n    // æŸ¥æ‰¾åŒ…å«ç‰¹å®šæ¨™è¨˜çš„è©•è«–ï¼ˆå„ªå…ˆæ‰¾ Botï¼Œä½†å¦‚æœæœ‰æ¨™è¨˜å°±ä½¿ç”¨ï¼‰\n    const botComment = comments.find(comment => {\n      const body = comment.body || '';\n      // åªè¦åŒ…å«æ¨™è¨˜å°±è¦–ç‚ºæˆ‘å€‘çš„è©•è«–ï¼ˆä¸é™åˆ¶ Botï¼Œå› ç‚ºå¯èƒ½ä»¥å…¶ä»–èº«ä»½åŸ·è¡Œï¼‰\n      return body.includes('<!-- dev-advisor-mcp -->');\n    });\n\n    return botComment || null;\n  } catch (error) {\n    core.warning(`æŸ¥æ‰¾ç¾æœ‰è©•è«–å¤±æ•—: ${error instanceof Error ? error.message : String(error)}`);\n    return null;\n  }\n}\n\n/**\n * æ ¼å¼åŒ–è©•è«–å…§å®¹\n */\nfunction formatCommentBody(report) {\n  let body = '<!-- dev-advisor-mcp -->\\n\\n';\n  body += '# ğŸ” é–‹ç™¼æ±ºç­–é¡§å•åˆ†æå ±å‘Š\\n\\n';\n  body += `> æ­¤å ±å‘Šç”± [@mukiwu/dev-advisor-mcp](https://github.com/mukiwu/dev-advisor-mcp) è‡ªå‹•ç”Ÿæˆ\\n\\n`;\n\n  // æ·»åŠ ç¾ä»£åŒ–åˆ†æå ±å‘Š\n  if (report.modernization) {\n    body += '## ğŸ“Š ç¨‹å¼ç¢¼ç¾ä»£åŒ–åˆ†æ\\n\\n';\n    const modernizationReport = report.modernization.report;\n\n    // å¦‚æœå ±å‘Šå¤ªé•·ï¼Œæˆªæ–·ä¸¦æ·»åŠ æç¤º\n    if (modernizationReport.length > MAX_COMMENT_LENGTH - body.length - 1000) {\n      const truncated = modernizationReport.substring(0, MAX_COMMENT_LENGTH - body.length - 1000);\n      body += truncated;\n      body += '\\n\\n---\\n\\n';\n      body += '> âš ï¸ å ±å‘Šå…§å®¹éé•·ï¼Œå·²æˆªæ–·ã€‚è«‹æŸ¥çœ‹å®Œæ•´çš„åˆ†æçµæœã€‚\\n\\n';\n    } else {\n      body += modernizationReport;\n      body += '\\n\\n---\\n\\n';\n    }\n  }\n\n  // æ·»åŠ ç›¸å®¹æ€§åˆ†æå ±å‘Š\n  if (report.compatibility) {\n    body += '## ğŸŒ API ç›¸å®¹æ€§åˆ†æ\\n\\n';\n    const compatibilityReport = report.compatibility.report;\n\n    // æª¢æŸ¥é•·åº¦\n    const remainingLength = MAX_COMMENT_LENGTH - body.length;\n    if (compatibilityReport.length > remainingLength - 1000) {\n      const truncated = compatibilityReport.substring(0, remainingLength - 1000);\n      body += truncated;\n      body += '\\n\\n---\\n\\n';\n      body += '> âš ï¸ å ±å‘Šå…§å®¹éé•·ï¼Œå·²æˆªæ–·ã€‚è«‹æŸ¥çœ‹å®Œæ•´çš„åˆ†æçµæœã€‚\\n\\n';\n    } else {\n      body += compatibilityReport;\n      body += '\\n\\n---\\n\\n';\n    }\n  }\n\n  // æ·»åŠ éŒ¯èª¤è³‡è¨Š\n  if (report.errors && report.errors.length > 0) {\n    body += '## âš ï¸ åˆ†æéŒ¯èª¤\\n\\n';\n    for (const error of report.errors) {\n      body += `- **${error.type}**: ${error.error}\\n`;\n    }\n    body += '\\n';\n  }\n\n  // æ·»åŠ æ‘˜è¦\n  if (report.modernization || report.compatibility) {\n    body += '## ğŸ“‹ åˆ†ææ‘˜è¦\\n\\n';\n\n    if (report.modernization) {\n      const summary = report.modernization.summary;\n      body += '### ç¾ä»£åŒ–åˆ†æ\\n';\n      body += `- æƒææª”æ¡ˆ: ${summary.totalFiles}\\n`;\n      body += `- ç™¼ç¾å»ºè­°: ${summary.totalSuggestions}\\n`;\n      body += `- æ•ˆèƒ½æå‡: ${summary.performanceGain}%\\n`;\n      body += `- Bundle æ¸›å°‘: ${summary.bundleReduction}KB\\n`;\n      body += `- é¢¨éšªç­‰ç´š: ${summary.risk}\\n\\n`;\n    }\n\n    if (report.compatibility) {\n      const summary = report.compatibility.summary;\n      body += '### ç›¸å®¹æ€§åˆ†æ\\n';\n      body += `- åˆ†æçš„ API: ${summary.totalApis}\\n`;\n      body += `- å®Œå…¨ç›¸å®¹: ${summary.compatibleApis}\\n`;\n      body += `- ä¸ç›¸å®¹: ${summary.incompatibleApis}\\n`;\n      body += `- æ•´é«”ç›¸å®¹æ€§: ${summary.overallCompatibility}%\\n`;\n      body += `- éœ€è¦ Polyfill: ${summary.polyfillsNeeded}\\n\\n`;\n    }\n  }\n\n  body += '\\n---\\n';\n  body += '*æ­¤è©•è«–ç”± [@mukiwu/dev-advisor-mcp](https://github.com/mukiwu/dev-advisor-mcp) è‡ªå‹•ç”Ÿæˆ*\\n';\n\n  // ç¢ºä¿ä¸è¶…éé•·åº¦é™åˆ¶\n  if (body.length > MAX_COMMENT_LENGTH) {\n    body = body.substring(0, MAX_COMMENT_LENGTH - 200);\n    body += '\\n\\n---\\n\\n> âš ï¸ å ±å‘Šå…§å®¹éé•·ï¼Œå·²æˆªæ–·ã€‚\\n';\n  }\n\n  return body;\n}\n\n"],"names":[],"sourceRoot":""}