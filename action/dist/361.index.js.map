{"version":3,"file":"361.index.js","mappings":";;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;ACRA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC9vBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AC5kBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;ACtxBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AChaA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC9UA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AClbA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sources":[".././node_modules/browserslist/ sync",".././dist/src/data/modernization-rules.js",".././dist/src/analyzers/modernization.js",".././dist/src/analyzers/compatibility.js",".././dist/src/parsers/index.js",".././dist/src/utils/report-formatter.js",".././dist/src/services/caniuse-service.js",".././action/analyzer.js"],"sourcesContent":["function webpackEmptyContext(req) {\n\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\te.code = 'MODULE_NOT_FOUND';\n\tthrow e;\n}\nwebpackEmptyContext.keys = () => ([]);\nwebpackEmptyContext.resolve = webpackEmptyContext;\nwebpackEmptyContext.id = 64973;\nmodule.exports = webpackEmptyContext;","/**\n * 現代化規則資料庫\n */\nexport class ModernizationRules {\n    libraryRules = new Map();\n    apiRules = new Map();\n    constructor() {\n        this.initializeLibraryRules();\n        this.initializeApiRules();\n    }\n    /**\n     * 初始化函式庫規則\n     */\n    initializeLibraryRules() {\n        const rules = [\n            // jQuery 相關 - 最大的 bundle 減少機會\n            ['jquery', {\n                    name: 'jQuery',\n                    modernAlternative: '原生 DOM API / 現代框架',\n                    reason: 'jQuery (約85KB) 在現代瀏覽器中已不再必要，原生 API 已足夠強大，可大幅減少 bundle 大小',\n                    compatibility: '所有現代瀏覽器',\n                    impact: { performance: 15, bundle: 85, maintainability: 3 },\n                    difficulty: 'moderate',\n                    breaking: true,\n                    deprecated: false,\n                    severity: 'medium',\n                    migrationExample: `// 舊版\n$('#element').addClass('active');\n$('.items').each(function() { ... });\n\n// 現代版\ndocument.getElementById('element').classList.add('active');\ndocument.querySelectorAll('.items').forEach(el => { ... });`,\n                    references: ['https://youmightnotneedjquery.com/']\n                }],\n            // Moment.js\n            ['moment', {\n                    name: 'Moment.js',\n                    modernAlternative: 'Date-fns / Dayjs / 原生 Temporal API',\n                    reason: 'Moment.js 體積過大且不支援 tree-shaking，現代替代方案更輕量',\n                    compatibility: '現代瀏覽器支援',\n                    impact: { performance: 25, bundle: 65, maintainability: 4 },\n                    difficulty: 'simple',\n                    breaking: true,\n                    deprecated: true,\n                    severity: 'high',\n                    migrationExample: `// 舊版 (Moment.js)\nmoment().format('YYYY-MM-DD');\n\n// 現代版 (Date-fns)\nimport { format } from 'date-fns';\nformat(new Date(), 'yyyy-MM-dd');\n\n// 未來 (Temporal)\nTemporal.now.plainDateISO().toString();`,\n                    references: ['https://momentjs.com/docs/#/-project-status/']\n                }],\n            // Lodash\n            ['lodash', {\n                    name: 'Lodash',\n                    modernAlternative: '原生 JavaScript 方法',\n                    reason: '許多 Lodash 功能現在已有原生支援，可減少依賴',\n                    compatibility: 'ES2015+ 瀏覽器',\n                    impact: { performance: 10, bundle: 50, maintainability: 3 },\n                    difficulty: 'simple',\n                    breaking: false,\n                    deprecated: false,\n                    severity: 'low',\n                    migrationExample: `// 舊版 (Lodash)\n_.map(array, fn);\n_.filter(array, predicate);\n\n// 現代版 (原生)\narray.map(fn);\narray.filter(predicate);`,\n                    references: ['https://youmightnotneedlodash.com/']\n                }],\n            // Request (已棄用)\n            ['request', {\n                    name: 'Request',\n                    modernAlternative: 'node-fetch / axios / 原生 fetch',\n                    reason: 'Request 已棄用，建議使用現代 HTTP 客戶端',\n                    compatibility: 'Node.js + 現代瀏覽器',\n                    impact: { performance: 20, bundle: 30, maintainability: 4 },\n                    difficulty: 'simple',\n                    breaking: true,\n                    deprecated: true,\n                    severity: 'high',\n                    migrationExample: `// 舊版 (Request)\nrequest.get(url, callback);\n\n// 現代版 (fetch)\nconst response = await fetch(url);\nconst data = await response.json();`,\n                    references: ['https://github.com/request/request/issues/3142']\n                }],\n            // Left-pad (安全性問題)\n            ['left-pad', {\n                    name: 'left-pad',\n                    modernAlternative: 'String.prototype.padStart()',\n                    reason: '原生方法已支援，無需額外依賴',\n                    compatibility: 'ES2017+ 瀏覽器',\n                    impact: { performance: 5, bundle: 1, maintainability: 2 },\n                    difficulty: 'trivial',\n                    breaking: false,\n                    deprecated: false,\n                    severity: 'low',\n                    migrationExample: `// 舊版\nconst leftPad = require('left-pad');\nleftPad('hello', 10, '0');\n\n// 現代版\n'hello'.padStart(10, '0');`,\n                }],\n            // Core-js polyfills\n            ['core-js', {\n                    name: 'core-js',\n                    modernAlternative: '選擇性 polyfill 或原生支援',\n                    reason: '根據目標瀏覽器選擇必要的 polyfill，避免過度 polyfill',\n                    compatibility: '根據 browserslist 決定',\n                    impact: { performance: 30, bundle: 100, maintainability: 3 },\n                    difficulty: 'moderate',\n                    breaking: false,\n                    deprecated: false,\n                    severity: 'medium',\n                    migrationExample: `// 分析：檢查 browserslist 設定\n// 只載入必要的 polyfill\nimport 'core-js/stable/array/includes'; // 僅在需要時載入`,\n                }],\n            // Underscore.js (類似 Lodash)\n            ['underscore', {\n                    name: 'Underscore.js',\n                    modernAlternative: '原生 JavaScript 方法',\n                    reason: 'Underscore.js 的大部分功能現在已有原生支援',\n                    compatibility: 'ES5+ 瀏覽器',\n                    impact: { performance: 8, bundle: 25, maintainability: 3 },\n                    difficulty: 'simple',\n                    breaking: false,\n                    deprecated: false,\n                    severity: 'low',\n                    migrationExample: `// 舊版 (Underscore)\n_.each(array, fn);\n_.map(array, fn);\n\n// 現代版\narray.forEach(fn);\narray.map(fn);`,\n                }],\n            // Bluebird Promise\n            ['bluebird', {\n                    name: 'Bluebird',\n                    modernAlternative: '原生 Promise',\n                    reason: '原生 Promise 已支援大部分功能，Bluebird 在現代環境中已非必要',\n                    compatibility: '所有現代瀏覽器',\n                    impact: { performance: 5, bundle: 45, maintainability: 2 },\n                    difficulty: 'simple',\n                    breaking: true,\n                    deprecated: false,\n                    severity: 'low',\n                    migrationExample: `// 舊版 (Bluebird)\nconst Promise = require('bluebird');\nPromise.map(items, fn);\n\n// 現代版\nPromise.all(items.map(fn));\n\n// 或使用 for await...of\nfor await (const result of asyncIterator) { ... }`,\n                }],\n            // Async.js\n            ['async', {\n                    name: 'Async.js',\n                    modernAlternative: 'async/await + Promise',\n                    reason: 'async/await 語法提供更簡潔的非同步控制流程',\n                    compatibility: 'ES2017+ 瀏覽器',\n                    impact: { performance: 0, bundle: 20, maintainability: 4 },\n                    difficulty: 'moderate',\n                    breaking: true,\n                    deprecated: false,\n                    severity: 'medium',\n                    migrationExample: `// 舊版 (Async.js)\nasync.waterfall([fn1, fn2, fn3], callback);\nasync.parallel([task1, task2], callback);\n\n// 現代版\n// waterfall\nconst result1 = await fn1();\nconst result2 = await fn2(result1);\nconst result3 = await fn3(result2);\n\n// parallel\nconst [res1, res2] = await Promise.all([task1(), task2()]);`,\n                }],\n            // uuid\n            ['uuid', {\n                    name: 'uuid',\n                    modernAlternative: 'crypto.randomUUID()',\n                    reason: '瀏覽器和 Node.js 現已支援原生 UUID 生成',\n                    compatibility: 'Chrome 92+, Firefox 95+, Safari 15.4+, Node.js 19+',\n                    impact: { performance: 2, bundle: 8, maintainability: 2 },\n                    difficulty: 'trivial',\n                    breaking: false,\n                    deprecated: false,\n                    severity: 'low',\n                    migrationExample: `// 舊版 (uuid)\nimport { v4 as uuidv4 } from 'uuid';\nconst id = uuidv4();\n\n// 現代版\nconst id = crypto.randomUUID();`,\n                }],\n            // is-number / is-array 等小型工具\n            ['is-number', {\n                    name: 'is-number',\n                    modernAlternative: 'typeof + Number.isFinite()',\n                    reason: '原生方法已可完成相同功能',\n                    compatibility: '所有現代瀏覽器',\n                    impact: { performance: 0, bundle: 1, maintainability: 1 },\n                    difficulty: 'trivial',\n                    breaking: false,\n                    deprecated: false,\n                    severity: 'low',\n                    migrationExample: `// 舊版\nconst isNumber = require('is-number');\nisNumber(value);\n\n// 現代版\ntypeof value === 'number' && Number.isFinite(value);`,\n                }],\n            ['is-array', {\n                    name: 'is-array',\n                    modernAlternative: 'Array.isArray()',\n                    reason: '原生 Array.isArray() 方法已存在多年',\n                    compatibility: '所有瀏覽器 (IE9+)',\n                    impact: { performance: 0, bundle: 1, maintainability: 1 },\n                    difficulty: 'trivial',\n                    breaking: false,\n                    deprecated: false,\n                    severity: 'low',\n                    migrationExample: `// 舊版\nconst isArray = require('is-array');\nisArray(value);\n\n// 現代版\nArray.isArray(value);`,\n                }],\n            // object-assign\n            ['object-assign', {\n                    name: 'object-assign',\n                    modernAlternative: 'Object.assign() 或展開運算子',\n                    reason: '原生 Object.assign() 和展開運算子已廣泛支援',\n                    compatibility: 'ES2015+ 瀏覽器',\n                    impact: { performance: 0, bundle: 2, maintainability: 2 },\n                    difficulty: 'trivial',\n                    breaking: false,\n                    deprecated: false,\n                    severity: 'low',\n                    migrationExample: `// 舊版\nconst assign = require('object-assign');\nassign({}, obj1, obj2);\n\n// 現代版\nObject.assign({}, obj1, obj2);\n// 或\n{ ...obj1, ...obj2 };`,\n                }],\n            // array-flatten\n            ['array-flatten', {\n                    name: 'array-flatten',\n                    modernAlternative: 'Array.prototype.flat()',\n                    reason: '原生 flat() 方法已廣泛支援',\n                    compatibility: 'ES2019+ 瀏覽器',\n                    impact: { performance: 0, bundle: 2, maintainability: 2 },\n                    difficulty: 'trivial',\n                    breaking: false,\n                    deprecated: false,\n                    severity: 'low',\n                    migrationExample: `// 舊版\nconst flatten = require('array-flatten');\nflatten([1, [2, [3]]]);\n\n// 現代版\n[1, [2, [3]]].flat(Infinity);  // 完全展平\n[1, [2, [3]]].flat(1);         // 展平一層`,\n                }],\n            // classnames / clsx\n            ['classnames', {\n                    name: 'classnames',\n                    modernAlternative: '模板字串或原生陣列方法',\n                    reason: '簡單場景可用模板字串處理，但 classnames 在複雜場景仍很有用',\n                    compatibility: '所有瀏覽器',\n                    impact: { performance: 0, bundle: 2, maintainability: 1 },\n                    difficulty: 'simple',\n                    breaking: false,\n                    deprecated: false,\n                    severity: 'low',\n                    migrationExample: `// 舊版\nimport classNames from 'classnames';\nclassNames('foo', { bar: true, baz: false });\n\n// 現代版 (簡單場景)\nconst classes = ['foo', isBar && 'bar', isBaz && 'baz'].filter(Boolean).join(' ');\n\n// 或使用模板字串\n\\`foo \\${isBar ? 'bar' : ''} \\${isBaz ? 'baz' : ''}\\`.trim();`,\n                }],\n            // querystring\n            ['querystring', {\n                    name: 'querystring',\n                    modernAlternative: 'URLSearchParams',\n                    reason: 'URLSearchParams 是瀏覽器原生 API，Node.js 也支援',\n                    compatibility: '所有現代瀏覽器',\n                    impact: { performance: 2, bundle: 5, maintainability: 3 },\n                    difficulty: 'simple',\n                    breaking: false,\n                    deprecated: true,\n                    severity: 'medium',\n                    migrationExample: `// 舊版 (querystring)\nconst qs = require('querystring');\nqs.parse('foo=bar&baz=qux');\nqs.stringify({ foo: 'bar' });\n\n// 現代版\nconst params = new URLSearchParams('foo=bar&baz=qux');\nparams.get('foo'); // 'bar'\n\nconst search = new URLSearchParams({ foo: 'bar' });\nsearch.toString(); // 'foo=bar'`,\n                }],\n            // node-fetch (在 Node.js 18+)\n            ['node-fetch', {\n                    name: 'node-fetch',\n                    modernAlternative: '原生 fetch (Node.js 18+)',\n                    reason: 'Node.js 18+ 已內建 fetch API',\n                    compatibility: 'Node.js 18+',\n                    impact: { performance: 5, bundle: 15, maintainability: 2 },\n                    difficulty: 'trivial',\n                    breaking: false,\n                    deprecated: false,\n                    severity: 'low',\n                    migrationExample: `// 舊版\nconst fetch = require('node-fetch');\nconst response = await fetch(url);\n\n// 現代版 (Node.js 18+)\n// 直接使用，無需 import\nconst response = await fetch(url);`,\n                    references: ['https://nodejs.org/dist/latest-v18.x/docs/api/globals.html#fetch']\n                }]\n        ];\n        for (const [key, rule] of rules) {\n            this.libraryRules.set(key, rule);\n        }\n    }\n    /**\n     * 初始化 API 規則\n     */\n    initializeApiRules() {\n        const rules = [\n            // XMLHttpRequest → fetch\n            ['XMLHttpRequest', {\n                    name: 'XMLHttpRequest',\n                    modernAlternative: 'fetch API',\n                    reason: 'fetch API 提供更現代、Promise 化的 HTTP 介面',\n                    compatibility: '現代瀏覽器 (IE 需要 polyfill)',\n                    impact: { performance: 10, bundle: 0, maintainability: 4 },\n                    difficulty: 'simple',\n                    breaking: true,\n                    deprecated: false,\n                    migrationExample: `// 舊版\nconst xhr = new XMLHttpRequest();\nxhr.open('GET', '/api/data');\nxhr.onreadystatechange = function() {\n  if (xhr.readyState === 4) {\n    callback(JSON.parse(xhr.responseText));\n  }\n};\nxhr.send();\n\n// 現代版\nconst response = await fetch('/api/data');\nconst data = await response.json();`,\n                }],\n            // setTimeout callback → Promise\n            ['setTimeout', {\n                    name: 'setTimeout (callback pattern)',\n                    modernAlternative: 'Promise-based timer',\n                    reason: '避免回調地獄，提供更好的錯誤處理',\n                    compatibility: '所有現代瀏覽器',\n                    impact: { performance: 0, bundle: 0, maintainability: 3 },\n                    difficulty: 'simple',\n                    breaking: false,\n                    deprecated: false,\n                    migrationExample: `// 舊版 (回調模式)\nfunction delay(ms, callback) {\n  setTimeout(callback, ms);\n}\n\n// 現代版 (Promise)\nfunction delay(ms) {\n  return new Promise(resolve => setTimeout(resolve, ms));\n}\n\n// 使用\nawait delay(1000);`,\n                }],\n            // document.getElementById → querySelector\n            ['document.getElementById', {\n                    name: 'document.getElementById',\n                    modernAlternative: 'document.querySelector',\n                    reason: 'querySelector 提供更一致的 API 和更強大的選擇能力',\n                    compatibility: '所有現代瀏覽器',\n                    impact: { performance: 0, bundle: 0, maintainability: 2 },\n                    difficulty: 'trivial',\n                    breaking: false,\n                    deprecated: false,\n                    migrationExample: `// 舊版\nconst element = document.getElementById('myId');\n\n// 現代版 (可選)\nconst element = document.querySelector('#myId');`,\n                }],\n            // addEventListener → modern event handling\n            ['attachEvent', {\n                    name: 'attachEvent',\n                    modernAlternative: 'addEventListener',\n                    reason: 'attachEvent 是 IE 特有的過時 API',\n                    compatibility: 'IE 已不再支援',\n                    impact: { performance: 0, bundle: -2, maintainability: 3 },\n                    difficulty: 'simple',\n                    breaking: true,\n                    deprecated: true,\n                    severity: 'high',\n                    migrationExample: `// 舊版 (IE only)\nelement.attachEvent('onclick', handler);\n\n// 現代版\nelement.addEventListener('click', handler);`,\n                }],\n            // var → let/const\n            ['var', {\n                    name: 'var declarations',\n                    modernAlternative: 'let/const',\n                    reason: 'let/const 提供更好的作用域控制，避免 hoisting 問題',\n                    compatibility: 'ES2015+ 瀏覽器',\n                    impact: { performance: 0, bundle: 0, maintainability: 3 },\n                    difficulty: 'trivial',\n                    breaking: false,\n                    deprecated: false,\n                    migrationExample: `// 舊版\nvar name = 'John';\nvar age = 30;\n\n// 現代版\nconst name = 'John';  // 不會改變\nlet age = 30;         // 可能改變`,\n                }],\n            // for loop → array methods\n            ['for', {\n                    name: 'traditional for loops',\n                    modernAlternative: 'Array methods (map, filter, forEach)',\n                    reason: '陣列方法更具表達性，減少錯誤機會',\n                    compatibility: 'ES5+ 瀏覽器',\n                    impact: { performance: 0, bundle: 0, maintainability: 4 },\n                    difficulty: 'simple',\n                    breaking: false,\n                    deprecated: false,\n                    migrationExample: `// 舊版\nconst result = [];\nfor (let i = 0; i < items.length; i++) {\n  if (items[i].active) {\n    result.push(items[i].name);\n  }\n}\n\n// 現代版\nconst result = items\n  .filter(item => item.active)\n  .map(item => item.name);`,\n                }],\n            // document.write - 危險的 API\n            ['document.write', {\n                    name: 'document.write',\n                    modernAlternative: 'DOM API (innerHTML, appendChild)',\n                    reason: 'document.write 會覆蓋整個頁面，在異步情況下特別危險',\n                    compatibility: '所有瀏覽器',\n                    impact: { performance: 10, bundle: 0, maintainability: 5 },\n                    difficulty: 'simple',\n                    breaking: true,\n                    deprecated: true,\n                    severity: 'high',\n                    migrationExample: `// 舊版 (危險)\ndocument.write('<h1>Hello</h1>');\n\n// 現代版\ndocument.body.innerHTML = '<h1>Hello</h1>';\n// 或\nconst h1 = document.createElement('h1');\nh1.textContent = 'Hello';\ndocument.body.appendChild(h1);`,\n                }],\n            // eval - 安全風險\n            ['eval', {\n                    name: 'eval',\n                    modernAlternative: 'Function 構造函數或其他安全替代方案',\n                    reason: 'eval 有嚴重的安全風險 (XSS)，且影響效能優化',\n                    compatibility: '所有瀏覽器',\n                    impact: { performance: 20, bundle: 0, maintainability: 5 },\n                    difficulty: 'moderate',\n                    breaking: true,\n                    deprecated: false,\n                    severity: 'high',\n                    migrationExample: `// 舊版 (危險)\nconst result = eval('2 + 2');\nconst fn = eval('(function() { return x + y; })');\n\n// 現代版\n// 對於數學計算，直接使用 JavaScript\nconst result = 2 + 2;\n\n// 對於動態函式，使用 Function 構造函數 (仍需謹慎)\nconst fn = new Function('x', 'y', 'return x + y');\n\n// 對於 JSON，使用 JSON.parse\nconst data = JSON.parse(jsonString);`,\n                }],\n            // with - 已棄用\n            ['with', {\n                    name: 'with statement',\n                    modernAlternative: '解構賦值或直接存取',\n                    reason: 'with 語句在 strict mode 中被禁止，且會造成作用域混淆',\n                    compatibility: '所有瀏覽器 (但 strict mode 禁止)',\n                    impact: { performance: 5, bundle: 0, maintainability: 4 },\n                    difficulty: 'simple',\n                    breaking: true,\n                    deprecated: true,\n                    severity: 'high',\n                    migrationExample: `// 舊版 (已棄用)\nwith (obj) {\n  console.log(a, b, c);\n}\n\n// 現代版 - 解構賦值\nconst { a, b, c } = obj;\nconsole.log(a, b, c);`,\n                }],\n            // arguments - 建議使用 rest parameters\n            ['arguments', {\n                    name: 'arguments object',\n                    modernAlternative: 'Rest parameters (...args)',\n                    reason: 'Rest parameters 是真正的陣列，語法更清晰',\n                    compatibility: 'ES2015+ 瀏覽器',\n                    impact: { performance: 0, bundle: 0, maintainability: 3 },\n                    difficulty: 'simple',\n                    breaking: false,\n                    deprecated: false,\n                    migrationExample: `// 舊版\nfunction sum() {\n  let total = 0;\n  for (let i = 0; i < arguments.length; i++) {\n    total += arguments[i];\n  }\n  return total;\n}\n\n// 現代版\nfunction sum(...numbers) {\n  return numbers.reduce((a, b) => a + b, 0);\n}`,\n                }],\n            // innerHTML 安全警告\n            ['innerHTML', {\n                    name: 'innerHTML',\n                    modernAlternative: 'textContent 或 DOM API',\n                    reason: '使用 innerHTML 插入使用者輸入可能導致 XSS 攻擊',\n                    compatibility: '所有瀏覽器',\n                    impact: { performance: 0, bundle: 0, maintainability: 2 },\n                    difficulty: 'simple',\n                    breaking: false,\n                    deprecated: false,\n                    severity: 'medium',\n                    migrationExample: `// 舊版 (有 XSS 風險)\nelement.innerHTML = userInput;\n\n// 現代版 - 純文字\nelement.textContent = userInput;\n\n// 現代版 - 需要 HTML 時使用 DOM API\nconst p = document.createElement('p');\np.textContent = userInput;\nelement.appendChild(p);\n\n// 或使用 DOMPurify 清理 HTML\nimport DOMPurify from 'dompurify';\nelement.innerHTML = DOMPurify.sanitize(htmlContent);`,\n                }],\n            // new Array() → []\n            ['new Array', {\n                    name: 'new Array()',\n                    modernAlternative: '陣列字面量 []',\n                    reason: '陣列字面量更簡潔，且避免 new Array(n) 的歧義',\n                    compatibility: '所有瀏覽器',\n                    impact: { performance: 0, bundle: 0, maintainability: 1 },\n                    difficulty: 'trivial',\n                    breaking: false,\n                    deprecated: false,\n                    migrationExample: `// 舊版\nconst arr = new Array(1, 2, 3);\nconst empty = new Array();\n\n// 現代版\nconst arr = [1, 2, 3];\nconst empty = [];\n\n// 注意：new Array(5) 會建立長度為 5 的稀疏陣列\n// 如需建立填充陣列，使用：\nconst filled = Array.from({ length: 5 }, (_, i) => i);`,\n                }],\n            // new Object() → {}\n            ['new Object', {\n                    name: 'new Object()',\n                    modernAlternative: '物件字面量 {}',\n                    reason: '物件字面量更簡潔明瞭',\n                    compatibility: '所有瀏覽器',\n                    impact: { performance: 0, bundle: 0, maintainability: 1 },\n                    difficulty: 'trivial',\n                    breaking: false,\n                    deprecated: false,\n                    migrationExample: `// 舊版\nconst obj = new Object();\nobj.name = 'John';\n\n// 現代版\nconst obj = { name: 'John' };`,\n                }],\n            // String.prototype.substr → substring/slice\n            ['substr', {\n                    name: 'String.prototype.substr()',\n                    modernAlternative: 'substring() 或 slice()',\n                    reason: 'substr() 已被標記為遺留功能，建議使用 substring() 或 slice()',\n                    compatibility: '所有瀏覽器',\n                    impact: { performance: 0, bundle: 0, maintainability: 2 },\n                    difficulty: 'trivial',\n                    breaking: false,\n                    deprecated: true,\n                    severity: 'low',\n                    migrationExample: `// 舊版 (遺留)\nstr.substr(start, length);\n\n// 現代版\nstr.substring(start, start + length);\n// 或\nstr.slice(start, start + length);`,\n                }],\n            // Date 建構函數字串解析\n            ['Date.parse', {\n                    name: 'Date 字串解析',\n                    modernAlternative: '明確的日期解析或使用 Temporal API',\n                    reason: 'Date 字串解析在不同瀏覽器中行為不一致',\n                    compatibility: '所有瀏覽器',\n                    impact: { performance: 0, bundle: 0, maintainability: 3 },\n                    difficulty: 'simple',\n                    breaking: false,\n                    deprecated: false,\n                    severity: 'medium',\n                    migrationExample: `// 舊版 (行為不一致)\nnew Date('2024-01-15');\nDate.parse('Jan 15, 2024');\n\n// 現代版 - 明確指定\nnew Date(2024, 0, 15); // 月份從 0 開始\n\n// 或使用 ISO 8601 格式 (最可靠)\nnew Date('2024-01-15T00:00:00.000Z');\n\n// 未來：使用 Temporal API\n// Temporal.PlainDate.from('2024-01-15');`,\n                }]\n        ];\n        for (const [key, rule] of rules) {\n            this.apiRules.set(key, rule);\n        }\n    }\n    /**\n     * 取得函式庫規則\n     */\n    getLibraryRule(libraryName) {\n        return this.libraryRules.get(libraryName);\n    }\n    /**\n     * 取得 API 規則\n     */\n    getApiRule(apiName) {\n        return this.apiRules.get(apiName);\n    }\n    /**\n     * 取得所有函式庫規則\n     */\n    getAllLibraryRules() {\n        return new Map(this.libraryRules);\n    }\n    /**\n     * 取得所有 API 規則\n     */\n    getAllApiRules() {\n        return new Map(this.apiRules);\n    }\n    /**\n     * 搜尋相關規則\n     */\n    searchRules(query) {\n        const results = [];\n        const lowerQuery = query.toLowerCase();\n        // 搜尋函式庫規則\n        for (const [key, rule] of this.libraryRules) {\n            if (key.toLowerCase().includes(lowerQuery) ||\n                rule.name.toLowerCase().includes(lowerQuery) ||\n                rule.modernAlternative.toLowerCase().includes(lowerQuery)) {\n                results.push(rule);\n            }\n        }\n        // 搜尋 API 規則\n        for (const [key, rule] of this.apiRules) {\n            if (key.toLowerCase().includes(lowerQuery) ||\n                rule.name.toLowerCase().includes(lowerQuery) ||\n                rule.modernAlternative.toLowerCase().includes(lowerQuery)) {\n                results.push(rule);\n            }\n        }\n        return results;\n    }\n    /**\n     * 新增自定義規則\n     */\n    addLibraryRule(name, rule) {\n        this.libraryRules.set(name, rule);\n    }\n    /**\n     * 新增 API 規則\n     */\n    addApiRule(name, rule) {\n        this.apiRules.set(name, rule);\n    }\n    /**\n     * 取得統計資訊\n     */\n    getStatistics() {\n        const libraryCount = this.libraryRules.size;\n        const apiCount = this.apiRules.size;\n        let deprecatedCount = 0;\n        let highImpactCount = 0;\n        for (const rule of [...this.libraryRules.values(), ...this.apiRules.values()]) {\n            if (rule.deprecated)\n                deprecatedCount++;\n            if (rule.impact.performance > 20 || rule.impact.bundle > 50)\n                highImpactCount++;\n        }\n        return {\n            totalRules: libraryCount + apiCount,\n            libraryRules: libraryCount,\n            apiRules: apiCount,\n            deprecatedRules: deprecatedCount,\n            highImpactRules: highImpactCount\n        };\n    }\n}\n//# sourceMappingURL=modernization-rules.js.map","import { ModernizationRules } from '../data/modernization-rules.js';\n/**\n * 程式碼現代化分析器\n * 掃描程式碼找出可現代化的部分，提供升級建議\n */\nexport class ModernizationAnalyzer {\n    parser;\n    rules;\n    constructor(parser) {\n        this.parser = parser;\n        this.rules = new ModernizationRules();\n    }\n    /**\n     * 分析專案的現代化機會\n     */\n    async analyze(projectPath, includePatterns, excludePatterns) {\n        // 解析專案檔案\n        const parsedFiles = await this.parser.parseProject(projectPath, includePatterns, excludePatterns);\n        // 分析每個檔案\n        const fileAnalysis = [];\n        const allSuggestions = [];\n        for (const file of parsedFiles) {\n            const result = this.analyzeFile(file);\n            fileAnalysis.push(result);\n            allSuggestions.push(...result.suggestions);\n        }\n        // 彙總分析結果\n        const summary = this.generateSummary(fileAnalysis, allSuggestions);\n        const riskAssessment = this.assessRisk(allSuggestions);\n        return {\n            summary,\n            suggestions: allSuggestions,\n            fileAnalysis,\n            riskAssessment\n        };\n    }\n    /**\n     * 分析單一檔案\n     */\n    analyzeFile(file) {\n        const suggestions = [];\n        const legacyPatterns = [];\n        const modernizableApis = [];\n        // 分析 imports - 檢查過時的函式庫\n        this.analyzeImports(file.imports, suggestions, legacyPatterns);\n        // 分析 API 呼叫 - 檢查可現代化的 API\n        this.analyzeApiCalls(file.apiCalls, suggestions, modernizableApis);\n        // 分析 AST 模式 - 檢查程式碼模式\n        this.analyzeCodePatterns(file.ast, suggestions, legacyPatterns);\n        return {\n            filePath: file.filePath,\n            suggestions,\n            legacyPatterns,\n            modernizableApis\n        };\n    }\n    /**\n     * 分析 import 語句\n     */\n    analyzeImports(imports, suggestions, legacyPatterns) {\n        for (const imp of imports) {\n            const rule = this.rules.getLibraryRule(imp.source);\n            if (rule) {\n                suggestions.push({\n                    id: `modernize-${imp.source}`,\n                    type: 'library-replacement',\n                    title: `升級 ${imp.source} 到 ${rule.modernAlternative}`,\n                    description: rule.reason,\n                    currentCode: `import ... from '${imp.source}';`,\n                    modernCode: rule.migrationExample,\n                    location: imp.loc,\n                    impact: rule.impact,\n                    difficulty: rule.difficulty,\n                    breaking: rule.breaking\n                });\n                if (rule.deprecated) {\n                    legacyPatterns.push({\n                        type: 'outdated-library',\n                        pattern: imp.source,\n                        description: `${imp.source} 已過時，建議使用 ${rule.modernAlternative}`,\n                        location: imp.loc || { line: 0, column: 0 },\n                        severity: rule.severity || 'medium'\n                    });\n                }\n            }\n        }\n    }\n    /**\n     * 分析 API 呼叫\n     */\n    analyzeApiCalls(apiCalls, suggestions, modernizableApis) {\n        for (const call of apiCalls) {\n            const apiName = call.method ? `${call.api}.${call.method}` : call.api;\n            const rule = this.rules.getApiRule(apiName);\n            if (rule) {\n                suggestions.push({\n                    id: `api-${apiName}`,\n                    type: 'api-modernization',\n                    title: `使用現代 ${rule.modernAlternative} 替代 ${apiName}`,\n                    description: rule.reason,\n                    currentCode: this.generateApiCallCode(call),\n                    modernCode: rule.migrationExample,\n                    location: call.loc,\n                    impact: rule.impact,\n                    difficulty: rule.difficulty,\n                    breaking: rule.breaking\n                });\n                modernizableApis.push({\n                    currentApi: apiName,\n                    modernApi: rule.modernAlternative,\n                    reason: rule.reason,\n                    compatibility: rule.compatibility || '現代瀏覽器',\n                    migrationComplexity: rule.difficulty,\n                    location: call.loc || { line: 0, column: 0 }\n                });\n            }\n        }\n    }\n    /**\n     * 分析程式碼模式\n     */\n    analyzeCodePatterns(ast, suggestions, legacyPatterns) {\n        // 檢查常見的過時模式\n        this.findCallbackPatterns(ast, suggestions);\n        this.findVarDeclarations(ast, suggestions, legacyPatterns);\n        this.findIIFEPatterns(ast, suggestions);\n        this.findForLoopPatterns(ast, suggestions);\n    }\n    /**\n     * 檢查回調函式模式，建議使用 Promise/async-await\n     */\n    findCallbackPatterns(ast, suggestions) {\n        this.traverseAST(ast, (node) => {\n            if (node.type === 'CallExpression' && node.arguments?.length > 0) {\n                const lastArg = node.arguments[node.arguments.length - 1];\n                // 檢測函式作為最後一個參數的回調模式\n                if (lastArg?.type === 'FunctionExpression' && !lastArg.async) {\n                    const params = lastArg.params || [];\n                    // 檢查是否是 error-first callback 模式 (err, result)\n                    const isErrorFirstCallback = params.length >= 2 &&\n                        params[0]?.name?.toLowerCase().match(/^(err|error|e)$/);\n                    // 檢查是否是常見的異步 API 回調\n                    const calleeName = this.getCalleeName(node.callee);\n                    const asyncPatterns = [\n                        'readFile', 'writeFile', 'readdir', 'stat', 'mkdir', 'unlink',\n                        'request', 'get', 'post', 'put', 'delete',\n                        'query', 'execute', 'find', 'save',\n                        'setTimeout', 'setInterval'\n                    ];\n                    const isAsyncPattern = asyncPatterns.some(p => calleeName.toLowerCase().includes(p.toLowerCase()));\n                    if (isErrorFirstCallback || isAsyncPattern) {\n                        const funcName = this.getCalleeName(node.callee);\n                        suggestions.push({\n                            id: `callback-to-promise-${node.loc?.start?.line || 0}`,\n                            type: 'pattern-modernization',\n                            title: '將回調函式轉換為 Promise/async-await',\n                            description: isErrorFirstCallback\n                                ? '偵測到 error-first callback 模式，建議使用 Promise 包裝或使用原生 Promise API'\n                                : `偵測到 ${funcName} 使用回調模式，建議使用 Promise 版本的 API`,\n                            currentCode: `${funcName}(..., function(${params.map((p) => p.name || 'arg').join(', ')}) {\\n  // callback logic\\n});`,\n                            modernCode: isErrorFirstCallback\n                                ? `// 使用 Promise 包裝\\nconst result = await new Promise((resolve, reject) => {\\n  ${funcName}(..., (err, result) => {\\n    if (err) reject(err);\\n    else resolve(result);\\n  });\\n});\\n\\n// 或使用 util.promisify (Node.js)\\nimport { promisify } from 'util';\\nconst ${funcName}Async = promisify(${funcName});\\nconst result = await ${funcName}Async(...);`\n                                : `// 使用 async/await\\nconst result = await ${funcName}Async(...);\\n\\n// 或使用 Promise\\n${funcName}(...).then(result => {\\n  // handle result\\n}).catch(err => {\\n  // handle error\\n});`,\n                            location: node.loc ? { line: node.loc.start.line, column: node.loc.start.column } : undefined,\n                            impact: { performance: 0, bundle: 0, maintainability: 4 },\n                            difficulty: 'moderate',\n                            breaking: true\n                        });\n                    }\n                }\n            }\n        });\n    }\n    /**\n     * 取得呼叫者名稱\n     */\n    getCalleeName(callee) {\n        if (!callee)\n            return 'unknown';\n        if (callee.type === 'Identifier') {\n            return callee.name || 'unknown';\n        }\n        if (callee.type === 'MemberExpression') {\n            const obj = this.getCalleeName(callee.object);\n            const prop = callee.property?.name || callee.property?.value || 'unknown';\n            return `${obj}.${prop}`;\n        }\n        return 'unknown';\n    }\n    /**\n     * 檢查 var 宣告，建議使用 let/const\n     */\n    findVarDeclarations(ast, suggestions, legacyPatterns) {\n        this.traverseAST(ast, (node) => {\n            if (node.type === 'VariableDeclaration' && node.kind === 'var') {\n                const suggestion = node.declarations?.some((d) => d.init && (d.init.type === 'FunctionExpression' || d.init.type === 'ArrowFunctionExpression')) ? 'const' : 'let';\n                suggestions.push({\n                    id: `var-to-${suggestion}`,\n                    type: 'syntax-modernization',\n                    title: `將 var 改為 ${suggestion}`,\n                    description: `使用 ${suggestion} 可提供更好的作用域控制和意圖表達`,\n                    currentCode: `var ${node.declarations?.[0]?.id?.name || 'variable'} = ...`,\n                    modernCode: `${suggestion} ${node.declarations?.[0]?.id?.name || 'variable'} = ...`,\n                    location: node.loc ? { line: node.loc.start.line, column: node.loc.start.column } : undefined,\n                    impact: { performance: 0, bundle: 0, maintainability: 2 },\n                    difficulty: 'trivial',\n                    breaking: false\n                });\n                legacyPatterns.push({\n                    type: 'inefficient-pattern',\n                    pattern: 'var declaration',\n                    description: '使用 var 宣告變數，建議改用 let 或 const',\n                    location: node.loc ? { line: node.loc.start.line, column: node.loc.start.column } : { line: 0, column: 0 },\n                    severity: 'low'\n                });\n            }\n        });\n    }\n    /**\n     * 檢查 IIFE 模式，建議使用模組\n     */\n    findIIFEPatterns(ast, suggestions) {\n        this.traverseAST(ast, (node) => {\n            // 檢測 IIFE: (function() { ... })() 或 (() => { ... })()\n            if (node.type === 'CallExpression') {\n                const callee = node.callee;\n                // 檢查是否是 IIFE 模式\n                const isIIFE = (\n                // (function() {})()\n                (callee.type === 'FunctionExpression') ||\n                    // (() => {})()\n                    (callee.type === 'ArrowFunctionExpression') ||\n                    // (function() {})() 被括號包裹\n                    (callee.type === 'SequenceExpression' &&\n                        callee.expressions?.some((e) => e.type === 'FunctionExpression' || e.type === 'ArrowFunctionExpression')));\n                if (isIIFE) {\n                    // 檢查 IIFE 內部是否有 window.xxx = 或 global.xxx = 的賦值（模組模式）\n                    const hasModulePattern = this.checkForModulePattern(callee.body);\n                    // 檢查是否只是用於隔離作用域\n                    const hasPrivateVars = this.checkForPrivateVariables(callee.body);\n                    suggestions.push({\n                        id: `iife-to-module-${node.loc?.start?.line || 0}`,\n                        type: 'pattern-modernization',\n                        title: '將 IIFE 轉換為 ES6 模組',\n                        description: hasModulePattern\n                            ? '偵測到 IIFE 模組模式 (將方法掛載到 window/global)，建議轉換為 ES6 模組的 export/import'\n                            : hasPrivateVars\n                                ? '偵測到 IIFE 用於隔離私有變數，在 ES6 模組中每個檔案已有獨立作用域，可直接使用模組'\n                                : '偵測到 IIFE，如果用於隔離作用域，可考慮使用區塊作用域 ({ let/const }) 或模組',\n                        currentCode: `(function() {\n  var privateVar = 'secret';\n  ${hasModulePattern ? \"window.MyModule = { ... };\" : \"// private logic\"}\n})();`,\n                        modernCode: hasModulePattern\n                            ? `// myModule.js\nconst privateVar = 'secret';\n\nexport function publicMethod() {\n  return privateVar;\n}\n\n// main.js\nimport { publicMethod } from './myModule.js';`\n                            : `// 使用區塊作用域\n{\n  const privateVar = 'secret';\n  // logic here\n}\n\n// 或使用 ES6 模組 (推薦)\n// module.js\nconst privateVar = 'secret';\nexport const result = doSomething(privateVar);`,\n                        location: node.loc ? { line: node.loc.start.line, column: node.loc.start.column } : undefined,\n                        impact: { performance: 0, bundle: 0, maintainability: 4 },\n                        difficulty: hasModulePattern ? 'moderate' : 'simple',\n                        breaking: hasModulePattern\n                    });\n                }\n            }\n        });\n    }\n    /**\n     * 檢查是否有模組模式 (window.xxx = 或 global.xxx =)\n     */\n    checkForModulePattern(body) {\n        if (!body)\n            return false;\n        let hasModulePattern = false;\n        this.traverseAST(body, (node) => {\n            if (node.type === 'AssignmentExpression' &&\n                node.left?.type === 'MemberExpression') {\n                const obj = node.left.object;\n                if (obj?.type === 'Identifier' &&\n                    (obj.name === 'window' || obj.name === 'global' || obj.name === 'self')) {\n                    hasModulePattern = true;\n                }\n            }\n        });\n        return hasModulePattern;\n    }\n    /**\n     * 檢查是否有私有變數宣告\n     */\n    checkForPrivateVariables(body) {\n        if (!body)\n            return false;\n        let hasPrivateVars = false;\n        this.traverseAST(body, (node) => {\n            if (node.type === 'VariableDeclaration') {\n                hasPrivateVars = true;\n            }\n        });\n        return hasPrivateVars;\n    }\n    /**\n     * 檢查 for 迴圈，建議使用現代迭代方法\n     */\n    findForLoopPatterns(ast, suggestions) {\n        this.traverseAST(ast, (node) => {\n            // 檢測傳統 for 迴圈: for (let i = 0; i < arr.length; i++)\n            if (node.type === 'ForStatement') {\n                const analysis = this.analyzeForLoop(node);\n                if (analysis.isConvertible) {\n                    suggestions.push({\n                        id: `for-to-${analysis.suggestedMethod}-${node.loc?.start?.line || 0}`,\n                        type: 'pattern-modernization',\n                        title: `將 for 迴圈轉換為 ${analysis.suggestedMethod}()`,\n                        description: analysis.reason || `傳統 for 迴圈可使用陣列方法 ${analysis.suggestedMethod}() 取代，程式碼更簡潔、可讀性更高`,\n                        currentCode: `for (let i = 0; i < ${analysis.arrayName || 'array'}.length; i++) {\n  ${analysis.loopAction || '// loop body'}\n}`,\n                        modernCode: this.generateModernLoopCode(analysis),\n                        location: node.loc ? { line: node.loc.start.line, column: node.loc.start.column } : undefined,\n                        impact: { performance: 0, bundle: 0, maintainability: 4 },\n                        difficulty: 'simple',\n                        breaking: false\n                    });\n                }\n            }\n            // 檢測 for...in 迴圈用於陣列 (反模式)\n            if (node.type === 'ForInStatement') {\n                suggestions.push({\n                    id: `for-in-to-for-of-${node.loc?.start?.line || 0}`,\n                    type: 'pattern-modernization',\n                    title: '考慮將 for...in 改為 for...of 或陣列方法',\n                    description: 'for...in 會遍歷所有可枚舉屬性（包括原型鏈），對於陣列應使用 for...of 或陣列方法',\n                    currentCode: `for (const key in object) {\n  // iterating\n}`,\n                    modernCode: `// 對於陣列，使用 for...of\nfor (const item of array) {\n  // process item\n}\n\n// 對於物件，使用 Object.entries/keys/values\nfor (const [key, value] of Object.entries(object)) {\n  // process key and value\n}\n\n// 或使用 forEach\nObject.entries(object).forEach(([key, value]) => {\n  // process key and value\n});`,\n                    location: node.loc ? { line: node.loc.start.line, column: node.loc.start.column } : undefined,\n                    impact: { performance: 5, bundle: 0, maintainability: 3 },\n                    difficulty: 'simple',\n                    breaking: false\n                });\n            }\n        });\n    }\n    /**\n     * 分析 for 迴圈是否可轉換\n     */\n    analyzeForLoop(node) {\n        const { init, test, update, body } = node;\n        // 檢查基本結構\n        if (!init || !test || !update || !body) {\n            return { isConvertible: false, suggestedMethod: 'forEach' };\n        }\n        // 檢查是否是標準的 for (let i = 0; i < arr.length; i++) 模式\n        // 初始化: let/var i = 0\n        if (init.type !== 'VariableDeclaration' ||\n            !init.declarations?.[0]?.init ||\n            init.declarations[0].init.value !== 0) {\n            return { isConvertible: false, suggestedMethod: 'forEach' };\n        }\n        const iteratorName = init.declarations[0].id?.name;\n        // 測試條件: i < arr.length\n        let arrayName = '';\n        if (test.type === 'BinaryExpression' && (test.operator === '<' || test.operator === '<=')) {\n            if (test.right?.type === 'MemberExpression' &&\n                test.right.property?.name === 'length') {\n                arrayName = this.getCalleeName(test.right.object);\n            }\n        }\n        if (!arrayName) {\n            return { isConvertible: false, suggestedMethod: 'forEach' };\n        }\n        // 分析迴圈體\n        const bodyStatements = body.type === 'BlockStatement' ? body.body : [body];\n        let hasPush = false;\n        let hasConditional = false;\n        let hasReturn = false;\n        let hasBreak = false;\n        let pushTarget = '';\n        let loopAction = '';\n        this.traverseAST(body, (childNode) => {\n            // 檢查 push 操作\n            if (childNode.type === 'CallExpression' &&\n                childNode.callee?.type === 'MemberExpression' &&\n                childNode.callee.property?.name === 'push') {\n                hasPush = true;\n                pushTarget = this.getCalleeName(childNode.callee.object);\n            }\n            // 檢查條件判斷\n            if (childNode.type === 'IfStatement') {\n                hasConditional = true;\n            }\n            // 檢查提前返回\n            if (childNode.type === 'ReturnStatement') {\n                hasReturn = true;\n            }\n            // 檢查 break\n            if (childNode.type === 'BreakStatement') {\n                hasBreak = true;\n            }\n        });\n        // 根據模式決定建議的方法\n        if (hasReturn || hasBreak) {\n            return {\n                isConvertible: true,\n                suggestedMethod: 'find',\n                reason: '迴圈包含提前退出，可能適合使用 find()、some() 或 every()',\n                arrayName,\n                loopAction: 'if (condition) return item;'\n            };\n        }\n        if (hasPush && hasConditional) {\n            return {\n                isConvertible: true,\n                suggestedMethod: 'filter',\n                reason: '迴圈包含條件判斷後 push 元素，適合使用 filter()',\n                arrayName,\n                loopAction: `if (condition) ${pushTarget}.push(${arrayName}[i]);`\n            };\n        }\n        if (hasPush) {\n            return {\n                isConvertible: true,\n                suggestedMethod: 'map',\n                reason: '迴圈將處理結果 push 到新陣列，適合使用 map()',\n                arrayName,\n                loopAction: `${pushTarget}.push(transform(${arrayName}[i]));`\n            };\n        }\n        return {\n            isConvertible: true,\n            suggestedMethod: 'forEach',\n            reason: '標準迭代迴圈，可使用 forEach() 或 for...of',\n            arrayName,\n            loopAction: `// process ${arrayName}[i]`\n        };\n    }\n    /**\n     * 生成現代迴圈程式碼\n     */\n    generateModernLoopCode(analysis) {\n        const arr = analysis.arrayName || 'array';\n        switch (analysis.suggestedMethod) {\n            case 'map':\n                return `const result = ${arr}.map(item => {\n  // transform item\n  return transformedItem;\n});`;\n            case 'filter':\n                return `const result = ${arr}.filter(item => {\n  // return true to keep item\n  return condition;\n});`;\n            case 'find':\n                return `const found = ${arr}.find(item => {\n  // return true when item matches\n  return condition;\n});\n\n// 或使用 some() 檢查是否存在\nconst exists = ${arr}.some(item => condition);`;\n            case 'reduce':\n                return `const result = ${arr}.reduce((acc, item) => {\n  // accumulate result\n  return acc + item;\n}, initialValue);`;\n            case 'forEach':\n            default:\n                return `${arr}.forEach(item => {\n  // process item\n});\n\n// 或使用 for...of (支援 break/continue)\nfor (const item of ${arr}) {\n  // process item\n}`;\n        }\n    }\n    /**\n     * 生成摘要資訊\n     */\n    generateSummary(fileAnalysis, suggestions) {\n        const totalFiles = fileAnalysis.length;\n        const totalSuggestions = suggestions.length;\n        const potentialPerformanceGain = suggestions.reduce((total, s) => total + (s.impact?.performance || 0), 0);\n        const bundleSizeReduction = suggestions.reduce((total, s) => total + (s.impact?.bundle || 0), 0);\n        return {\n            totalFiles,\n            totalSuggestions,\n            potentialPerformanceGain,\n            bundleSizeReduction\n        };\n    }\n    /**\n     * 評估現代化風險\n     */\n    assessRisk(suggestions) {\n        const breakingChanges = suggestions\n            .filter(s => s.breaking)\n            .map(s => ({\n            type: s.type,\n            description: s.description,\n            impact: s.difficulty === 'complex' ? 'critical' : 'major',\n            mitigation: `請詳細測試 ${s.title} 的變更`\n        }));\n        const compatibilityIssues = []; // TODO: 實作相容性檢查\n        const complexSuggestions = suggestions.filter(s => s.difficulty === 'complex').length;\n        const moderateSuggestions = suggestions.filter(s => s.difficulty === 'moderate').length;\n        const estimatedHours = complexSuggestions * 8 +\n            moderateSuggestions * 2 +\n            (suggestions.length - complexSuggestions - moderateSuggestions) * 0.5;\n        const overallRisk = breakingChanges.length > 5 ? 'high' :\n            breakingChanges.length > 2 ? 'medium' : 'low';\n        return {\n            overallRisk: overallRisk,\n            breakingChanges,\n            compatibilityIssues,\n            migrationEffort: {\n                estimatedHours,\n                complexity: estimatedHours > 40 ? 'high' : estimatedHours > 16 ? 'medium' : 'low',\n                priority: overallRisk === 'low' && estimatedHours < 16 ? 'high' : 'medium'\n            }\n        };\n    }\n    /**\n     * 生成 API 呼叫程式碼\n     */\n    generateApiCallCode(call) {\n        const args = call.arguments?.map(arg => typeof arg === 'string' ? `'${arg}'` : JSON.stringify(arg)).join(', ') || '';\n        if (call.method) {\n            return `${call.api}.${call.method}(${args})`;\n        }\n        else {\n            return `${call.api}(${args})`;\n        }\n    }\n    /**\n     * 遍歷 AST\n     */\n    traverseAST(node, visitor) {\n        if (!node || typeof node !== 'object')\n            return;\n        visitor(node);\n        for (const key in node) {\n            const child = node[key];\n            if (child && typeof child === 'object') {\n                if (Array.isArray(child)) {\n                    for (const item of child) {\n                        if (item && typeof item === 'object' && item.type) {\n                            this.traverseAST(item, visitor);\n                        }\n                    }\n                }\n                else if (child.type) {\n                    this.traverseAST(child, visitor);\n                }\n            }\n        }\n    }\n}\n//# sourceMappingURL=modernization.js.map","/**\n * API 相容性分析器\n * 分析專案中使用的 API 與目標瀏覽器的相容性\n */\nimport browserslist from 'browserslist';\n/**\n * API 到 Can I Use ID 的映射\n */\nconst API_TO_CANIUSE_MAP = {\n    // Fetch & Network\n    'fetch': 'fetch',\n    'AbortController': 'abortcontroller',\n    'Headers': 'fetch',\n    'Request': 'fetch',\n    'Response': 'fetch',\n    // DOM APIs\n    'querySelector': 'queryselector',\n    'querySelectorAll': 'queryselector',\n    'classList': 'classlist',\n    'MutationObserver': 'mutationobserver',\n    'IntersectionObserver': 'intersectionobserver',\n    'ResizeObserver': 'resizeobserver',\n    // Storage\n    'localStorage': 'namevalue-storage',\n    'sessionStorage': 'namevalue-storage',\n    'indexedDB': 'indexeddb',\n    'IndexedDB': 'indexeddb',\n    // Media\n    'getUserMedia': 'stream',\n    'MediaRecorder': 'mediarecorder',\n    'AudioContext': 'audio-api',\n    'WebAudioAPI': 'audio-api',\n    // Graphics\n    'canvas': 'canvas',\n    'getContext': 'canvas',\n    'WebGL': 'webgl',\n    'WebGL2': 'webgl2',\n    // Async\n    'Promise': 'promises',\n    'async': 'async-functions',\n    'await': 'async-functions',\n    'Worker': 'webworkers',\n    'SharedWorker': 'sharedworkers',\n    'ServiceWorker': 'serviceworkers',\n    // URL\n    'URL': 'url',\n    'URLSearchParams': 'urlsearchparams',\n    'history.pushState': 'history',\n    'history.replaceState': 'history',\n    // Events\n    'CustomEvent': 'customevent',\n    'BroadcastChannel': 'broadcastchannel',\n    'WebSocket': 'websockets',\n    'EventSource': 'eventsource',\n    // File\n    'FileReader': 'fileapi',\n    'Blob': 'blobbuilder',\n    'File': 'fileapi',\n    'clipboard': 'async-clipboard',\n    'navigator.clipboard': 'async-clipboard',\n    // Location\n    'geolocation': 'geolocation',\n    'navigator.geolocation': 'geolocation',\n    // Notification\n    'Notification': 'notifications',\n    // Intl\n    'Intl.DateTimeFormat': 'internationalization',\n    'Intl.NumberFormat': 'internationalization',\n    'Intl.RelativeTimeFormat': 'mdn-javascript_builtins_intl_relativetimeformat',\n    'Intl.PluralRules': 'intl-pluralrules',\n    // Performance\n    'performance.now': 'high-resolution-time',\n    'performance.mark': 'user-timing',\n    'performance.measure': 'user-timing',\n    'PerformanceObserver': 'performance-observer',\n    // Crypto\n    'crypto.randomUUID': 'mdn-api_crypto_randomuuid',\n    'crypto.subtle': 'cryptography',\n    'SubtleCrypto': 'cryptography',\n    // Animation\n    'requestAnimationFrame': 'requestanimationframe',\n    'animate': 'web-animation',\n    'Animation': 'web-animation',\n    // CSS Features (detected via API)\n    'CSS.supports': 'css-supports-api',\n    'matchMedia': 'matchmedia',\n    // Other\n    'Proxy': 'proxy',\n    'Reflect': 'proxy',\n    'Symbol': 'es6',\n    'Map': 'es6',\n    'Set': 'es6',\n    'WeakMap': 'es6',\n    'WeakSet': 'es6',\n    'for...of': 'es6',\n    'let': 'let',\n    'const': 'const',\n    'arrow functions': 'arrow-functions',\n    'template literals': 'template-literals',\n    'destructuring': 'es6',\n    'spread operator': 'es6',\n    'rest parameters': 'rest-parameters',\n    'default parameters': 'es6',\n    'class': 'es6-class',\n    'Array.from': 'array-from',\n    'Array.includes': 'array-includes',\n    'Object.assign': 'object-assign',\n    'Object.entries': 'object-entries',\n    'Object.values': 'object-values',\n    'String.includes': 'es6',\n    'String.startsWith': 'es6',\n    'String.endsWith': 'es6',\n    'String.padStart': 'pad-start-end',\n    'String.padEnd': 'pad-start-end',\n    'Array.flat': 'array-flat',\n    'Array.flatMap': 'array-flat',\n    'Object.fromEntries': 'object-fromentries',\n    'globalThis': 'mdn-javascript_builtins_globalthis',\n    'BigInt': 'bigint',\n    'Optional chaining': 'mdn-javascript_operators_optional_chaining',\n    'Nullish coalescing': 'mdn-javascript_operators_nullish_coalescing',\n};\n/**\n * 已知的全域 Web API（單一識別符）\n * 這些是確定的瀏覽器原生 API，不是自訂函數\n */\nconst KNOWN_GLOBAL_APIS = new Set([\n    'fetch',\n    'Promise',\n    'Worker',\n    'SharedWorker',\n    'ServiceWorker',\n    'WebSocket',\n    'EventSource',\n    'Blob',\n    'File',\n    'FileReader',\n    'URL',\n    'URLSearchParams',\n    'FormData',\n    'Headers',\n    'Request',\n    'Response',\n    'AbortController',\n    'AbortSignal',\n    'CustomEvent',\n    'MutationObserver',\n    'IntersectionObserver',\n    'ResizeObserver',\n    'PerformanceObserver',\n    'MessageChannel',\n    'MessagePort',\n    'BroadcastChannel',\n    'Notification',\n    'Intl',\n    'Map',\n    'Set',\n    'WeakMap',\n    'WeakSet',\n    'Symbol',\n    'Proxy',\n    'Reflect',\n    'BigInt',\n    'AudioContext',\n    'MediaRecorder',\n    'MediaStream',\n    'ImageData',\n    'ImageBitmap',\n    'OffscreenCanvas',\n    'TextEncoder',\n    'TextDecoder',\n    'DOMParser',\n    'XMLSerializer',\n    'XPathEvaluator',\n]);\n/**\n * 已知的 Web API 物件（用於方法呼叫判斷）\n */\nconst KNOWN_WEB_API_OBJECTS = new Set([\n    'document',\n    'window',\n    'navigator',\n    'location',\n    'history',\n    'screen',\n    'console',\n    'localStorage',\n    'sessionStorage',\n    'indexedDB',\n    'crypto',\n    'performance',\n    'caches',\n    'fetch',\n    'Promise',\n    'Array',\n    'Object',\n    'String',\n    'Number',\n    'Math',\n    'Date',\n    'JSON',\n    'Intl',\n    'Reflect',\n    'Proxy',\n    'URL',\n    'URLSearchParams',\n    'FormData',\n    'Headers',\n    'Request',\n    'Response',\n    'Blob',\n    'File',\n    'FileReader',\n    'Worker',\n    'WebSocket',\n    'EventSource',\n    'Notification',\n    'AudioContext',\n    'CanvasRenderingContext2D',\n    'WebGLRenderingContext',\n    'MediaRecorder',\n]);\n/**\n * 瀏覽器名稱映射\n */\nconst BROWSER_NAME_MAP = {\n    'chrome': 'Chrome',\n    'firefox': 'Firefox',\n    'safari': 'Safari',\n    'edge': 'Edge',\n    'ie': 'Internet Explorer',\n    'opera': 'Opera',\n    'ios_saf': 'iOS Safari',\n    'android': 'Android Browser',\n    'samsung': 'Samsung Internet',\n    'op_mini': 'Opera Mini',\n    'op_mob': 'Opera Mobile',\n    'and_chr': 'Chrome for Android',\n    'and_ff': 'Firefox for Android',\n    'and_uc': 'UC Browser',\n    'kaios': 'KaiOS Browser',\n};\n/**\n * 相容性分析器\n */\nexport class CompatibilityAnalyzer {\n    parser;\n    canIUseService;\n    constructor(parser, canIUseService) {\n        this.parser = parser;\n        this.canIUseService = canIUseService;\n    }\n    /**\n     * 分析專案的 API 相容性\n     */\n    async analyze(projectPath, includePatterns, excludePatterns, browserslistConfig) {\n        // 1. 解析 browserslist 配置，取得目標瀏覽器\n        const { targetBrowsers, query } = this.parseBrowserslistConfig(projectPath, browserslistConfig);\n        // 2. 解析專案程式碼\n        const parsedFiles = await this.parser.parseProject(projectPath, includePatterns, excludePatterns);\n        // 3. 收集所有使用的 API\n        const apiUsageMap = this.collectApiUsage(parsedFiles);\n        // 4. 轉換目標瀏覽器為 CanIUse 格式\n        const browserVersions = this.convertBrowserVersions(targetBrowsers);\n        // 5. 檢查每個 API 的相容性\n        const issues = [];\n        const fileAnalysis = [];\n        for (const [api, locations] of apiUsageMap.entries()) {\n            const caniuseId = this.getCaniuseId(api);\n            if (!caniuseId)\n                continue;\n            try {\n                const compatibility = await this.canIUseService.checkCompatibility(caniuseId, browserVersions);\n                if (compatibility.notSupported.length > 0 || compatibility.partialSupport.length > 0) {\n                    const issue = this.createIssue(api, caniuseId, locations, compatibility);\n                    issues.push(issue);\n                }\n            }\n            catch (error) {\n                // 忽略無法查詢的 API\n                console.warn(`無法查詢 ${api} 的相容性:`, error);\n            }\n        }\n        // 6. 按檔案分組問題\n        for (const file of parsedFiles) {\n            const fileIssues = issues.filter(issue => issue.locations.some(loc => loc.file === file.filePath));\n            const apisUsed = Array.from(new Set(file.apiCalls.map(call => call.method ? `${call.api}.${call.method}` : call.api)));\n            fileAnalysis.push({\n                filePath: file.filePath,\n                apisUsed,\n                issues: fileIssues\n            });\n        }\n        // 7. 生成 Polyfill 建議\n        const polyfillRecommendations = this.generatePolyfillRecommendations(issues);\n        // 8. 計算摘要\n        const summary = this.generateSummary(apiUsageMap.size, issues);\n        return {\n            summary,\n            targetBrowsers,\n            browserslistQuery: query,\n            issues,\n            polyfillRecommendations,\n            fileAnalysis\n        };\n    }\n    /**\n     * 解析 browserslist 配置\n     */\n    parseBrowserslistConfig(projectPath, configString) {\n        let query;\n        let browsers;\n        try {\n            if (configString) {\n                // 使用傳入的配置\n                query = configString;\n                browsers = browserslist(configString);\n            }\n            else {\n                // 自動偵測專案配置\n                browsers = browserslist(undefined, { path: projectPath });\n                query = 'defaults (from project config)';\n            }\n        }\n        catch (error) {\n            // 使用預設配置\n            query = 'defaults';\n            browsers = browserslist('defaults');\n        }\n        // 解析瀏覽器版本\n        const targetBrowsers = browsers.map(browser => {\n            const [name, version] = browser.split(' ');\n            return {\n                name: name.toLowerCase(),\n                version,\n                displayName: `${BROWSER_NAME_MAP[name.toLowerCase()] || name} ${version}`\n            };\n        });\n        // 去重並按瀏覽器名稱分組，只保留最低版本\n        const browserMap = new Map();\n        for (const browser of targetBrowsers) {\n            const existing = browserMap.get(browser.name);\n            if (!existing || parseFloat(browser.version) < parseFloat(existing.version)) {\n                browserMap.set(browser.name, browser);\n            }\n        }\n        return {\n            targetBrowsers: Array.from(browserMap.values()),\n            query\n        };\n    }\n    /**\n     * 收集專案中使用的 API\n     */\n    collectApiUsage(files) {\n        const apiUsage = new Map();\n        for (const file of files) {\n            for (const call of file.apiCalls) {\n                const apiName = call.method ? `${call.api}.${call.method}` : call.api;\n                // 過濾掉明顯不是 Web API 的呼叫\n                if (this.isWebApi(apiName)) {\n                    const locations = apiUsage.get(apiName) || [];\n                    locations.push({\n                        file: file.filePath,\n                        line: call.loc?.line || 0,\n                        column: call.loc?.column || 0\n                    });\n                    apiUsage.set(apiName, locations);\n                }\n            }\n        }\n        return apiUsage;\n    }\n    /**\n     * 判斷是否是 Web API\n     * 使用嚴格匹配，避免誤判專案自訂函數\n     */\n    isWebApi(apiName) {\n        // 排除明顯的自訂函數（小寫字母開頭的單一函數名）\n        if (/^[a-z][a-zA-Z0-9]*$/.test(apiName) && !KNOWN_GLOBAL_APIS.has(apiName)) {\n            return false;\n        }\n        // 排除常見的自訂函數模式\n        const excludePatterns = [\n            /^(get|set|create|update|delete|fetch|load|save|handle|on|render|use)[A-Z]/, // 自訂函數命名\n            /^_/, // 私有函數\n            /\\$$/, // jQuery 風格\n            /^(is|has|can|should|will|did)[A-Z]/, // 判斷函數\n            /^(init|setup|config|process|parse|format|validate|transform)/i, // 工具函數\n        ];\n        // 如果是單一識別符（無點號），檢查是否為排除模式\n        if (!apiName.includes('.')) {\n            if (excludePatterns.some(pattern => pattern.test(apiName))) {\n                return false;\n            }\n        }\n        // 檢查是否在映射表中（精確匹配）\n        if (API_TO_CANIUSE_MAP[apiName])\n            return true;\n        // 檢查是否是已知的 Web API 物件方法呼叫\n        const parts = apiName.split('.');\n        if (parts.length >= 2) {\n            const [obj, method] = parts;\n            // 精確匹配物件名稱\n            if (KNOWN_WEB_API_OBJECTS.has(obj)) {\n                return true;\n            }\n            // 檢查完整的 API 路徑\n            const fullPath = `${obj}.${method}`;\n            if (API_TO_CANIUSE_MAP[fullPath]) {\n                return true;\n            }\n        }\n        return false;\n    }\n    /**\n     * 取得 Can I Use ID\n     * 使用精確匹配，避免誤判\n     */\n    getCaniuseId(apiName) {\n        // 1. 直接精確匹配\n        if (API_TO_CANIUSE_MAP[apiName]) {\n            return API_TO_CANIUSE_MAP[apiName];\n        }\n        // 2. 嘗試匹配物件名稱（如 fetch, Promise）\n        const parts = apiName.split('.');\n        if (parts.length >= 1) {\n            const obj = parts[0];\n            if (API_TO_CANIUSE_MAP[obj]) {\n                return API_TO_CANIUSE_MAP[obj];\n            }\n        }\n        // 3. 嘗試匹配完整路徑（如 navigator.geolocation）\n        if (parts.length >= 2) {\n            const fullPath = `${parts[0]}.${parts[1]}`;\n            if (API_TO_CANIUSE_MAP[fullPath]) {\n                return API_TO_CANIUSE_MAP[fullPath];\n            }\n        }\n        // 4. 不再使用模糊匹配，避免誤判\n        return null;\n    }\n    /**\n     * 轉換瀏覽器版本格式\n     */\n    convertBrowserVersions(browsers) {\n        const versions = {};\n        for (const browser of browsers) {\n            // 只取主要瀏覽器\n            if (['chrome', 'firefox', 'safari', 'edge', 'ie', 'opera', 'ios_saf', 'android'].includes(browser.name)) {\n                versions[browser.name] = browser.version;\n            }\n        }\n        return versions;\n    }\n    /**\n     * 建立相容性問題\n     */\n    createIssue(api, caniuseId, locations, compatibility) {\n        // 計算嚴重程度\n        let severity;\n        if (compatibility.notSupported.length >= 3) {\n            severity = 'critical';\n        }\n        else if (compatibility.notSupported.length >= 1) {\n            severity = 'high';\n        }\n        else if (compatibility.partialSupport.length >= 2) {\n            severity = 'medium';\n        }\n        else {\n            severity = 'low';\n        }\n        return {\n            api,\n            caniuseId,\n            locations,\n            globalSupport: compatibility.globalSupport,\n            unsupportedBrowsers: compatibility.notSupported,\n            partiallySupportedBrowsers: compatibility.partialSupport,\n            polyfillAvailable: compatibility.polyfillAvailable,\n            polyfillUrl: compatibility.polyfillUrl,\n            severity,\n            recommendation: compatibility.recommendation\n        };\n    }\n    /**\n     * 生成 Polyfill 建議\n     */\n    generatePolyfillRecommendations(issues) {\n        const recommendations = [];\n        const seen = new Set();\n        for (const issue of issues) {\n            if (issue.polyfillAvailable && issue.polyfillUrl && !seen.has(issue.api)) {\n                seen.add(issue.api);\n                recommendations.push({\n                    api: issue.api,\n                    polyfillUrl: issue.polyfillUrl,\n                    cdnScript: `<script src=\"${issue.polyfillUrl}\"></script>`,\n                    npmPackage: this.getNpmPackage(issue.api),\n                    affectedBrowsers: issue.unsupportedBrowsers\n                });\n            }\n        }\n        return recommendations;\n    }\n    /**\n     * 取得 npm 套件名稱\n     */\n    getNpmPackage(api) {\n        const npmPackages = {\n            'fetch': 'whatwg-fetch',\n            'Promise': 'es6-promise',\n            'IntersectionObserver': 'intersection-observer',\n            'ResizeObserver': 'resize-observer-polyfill',\n            'MutationObserver': 'mutationobserver-shim',\n            'URLSearchParams': 'url-search-params-polyfill',\n            'AbortController': 'abortcontroller-polyfill',\n            'CustomEvent': 'custom-event-polyfill',\n            'Symbol': 'core-js/features/symbol',\n            'Map': 'core-js/features/map',\n            'Set': 'core-js/features/set',\n            'Array.from': 'core-js/features/array/from',\n            'Array.includes': 'core-js/features/array/includes',\n            'Object.assign': 'core-js/features/object/assign',\n            'Object.entries': 'core-js/features/object/entries',\n            'String.includes': 'core-js/features/string/includes',\n        };\n        return npmPackages[api];\n    }\n    /**\n     * 生成摘要資訊\n     */\n    generateSummary(totalApis, issues) {\n        const incompatibleApis = issues.filter(i => i.unsupportedBrowsers.length > 0).length;\n        const partiallyCompatibleApis = issues.filter(i => i.unsupportedBrowsers.length === 0 && i.partiallySupportedBrowsers.length > 0).length;\n        const compatibleApis = totalApis - incompatibleApis - partiallyCompatibleApis;\n        const polyfillsNeeded = issues.filter(i => i.polyfillAvailable).length;\n        // 計算整體相容性百分比\n        const overallCompatibility = totalApis > 0\n            ? Math.round((compatibleApis / totalApis) * 100)\n            : 100;\n        return {\n            totalApisAnalyzed: totalApis,\n            compatibleApis,\n            incompatibleApis,\n            partiallyCompatibleApis,\n            overallCompatibility,\n            polyfillsNeeded\n        };\n    }\n}\n/**\n * 格式化相容性報告\n */\nexport function formatCompatibilityReport(analysis, format = 'markdown') {\n    switch (format) {\n        case 'json':\n            return JSON.stringify(analysis, null, 2);\n        case 'html':\n            return formatAsHtml(analysis);\n        case 'text':\n            return formatAsText(analysis);\n        case 'markdown':\n        default:\n            return formatAsMarkdown(analysis);\n    }\n}\n/**\n * 格式化為 Markdown\n */\nfunction formatAsMarkdown(analysis) {\n    const { summary, targetBrowsers, browserslistQuery, issues, polyfillRecommendations } = analysis;\n    let report = `# 🔍 API 相容性分析報告\\n\\n`;\n    // 摘要\n    report += `## 📊 執行摘要\\n\\n`;\n    report += createAsciiTable(['指標', '數值'], [\n        ['分析的 API 數量', String(summary.totalApisAnalyzed)],\n        ['完全相容', String(summary.compatibleApis)],\n        ['部分相容', String(summary.partiallyCompatibleApis)],\n        ['不相容', String(summary.incompatibleApis)],\n        ['整體相容性', `${summary.overallCompatibility}%`],\n        ['需要 Polyfill', String(summary.polyfillsNeeded)],\n    ]);\n    report += `\\n`;\n    // 目標瀏覽器\n    report += `## 🎯 目標瀏覽器\\n\\n`;\n    report += `**Browserslist 查詢**: \\`${browserslistQuery}\\`\\n\\n`;\n    if (targetBrowsers.length > 0) {\n        report += createAsciiTable(['瀏覽器', '最低版本'], targetBrowsers.map(browser => [\n            BROWSER_NAME_MAP[browser.name] || browser.name,\n            browser.version\n        ]));\n        report += `\\n`;\n    }\n    // 相容性問題\n    if (issues.length > 0) {\n        report += `## ⚠️ 相容性問題\\n\\n`;\n        // 按嚴重程度分組\n        const criticalIssues = issues.filter(i => i.severity === 'critical');\n        const highIssues = issues.filter(i => i.severity === 'high');\n        const mediumIssues = issues.filter(i => i.severity === 'medium');\n        const lowIssues = issues.filter(i => i.severity === 'low');\n        if (criticalIssues.length > 0) {\n            report += `### 🔴 嚴重問題 (${criticalIssues.length})\\n\\n`;\n            report += formatIssueTable(criticalIssues);\n        }\n        if (highIssues.length > 0) {\n            report += `### 🟠 高風險問題 (${highIssues.length})\\n\\n`;\n            report += formatIssueTable(highIssues);\n        }\n        if (mediumIssues.length > 0) {\n            report += `### 🟡 中風險問題 (${mediumIssues.length})\\n\\n`;\n            report += formatIssueTable(mediumIssues);\n        }\n        if (lowIssues.length > 0) {\n            report += `### 🟢 低風險問題 (${lowIssues.length})\\n\\n`;\n            report += formatIssueTable(lowIssues);\n        }\n    }\n    else {\n        report += `## ✅ 無相容性問題\\n\\n`;\n        report += `恭喜！所有使用的 API 在目標瀏覽器中都完全支援。\\n\\n`;\n    }\n    // Polyfill 建議\n    if (polyfillRecommendations.length > 0) {\n        report += `## 📦 Polyfill 建議\\n\\n`;\n        for (const rec of polyfillRecommendations) {\n            report += `### ${rec.api}\\n\\n`;\n            report += `**受影響的瀏覽器**: ${rec.affectedBrowsers.join(', ')}\\n\\n`;\n            report += `**CDN 引入**:\\n\\`\\`\\`html\\n${rec.cdnScript}\\n\\`\\`\\`\\n\\n`;\n            if (rec.npmPackage) {\n                report += `**npm 套件**: \\`${rec.npmPackage}\\`\\n\\n`;\n            }\n        }\n        // 統一 Polyfill 方案\n        report += `### 💡 統一 Polyfill 方案\\n\\n`;\n        report += `使用 [polyfill.io](https://polyfill.io) 自動按需載入 polyfill：\\n\\n`;\n        report += `\\`\\`\\`html\\n<script src=\"https://polyfill.io/v3/polyfill.min.js?features=${polyfillRecommendations.map(r => r.api).join('%2C')}\"></script>\\n\\`\\`\\`\\n\\n`;\n    }\n    // 結論\n    report += `## 📝 總結\\n\\n`;\n    if (summary.overallCompatibility >= 90) {\n        report += `✅ 專案的 API 相容性良好，整體相容性達 ${summary.overallCompatibility}%。\\n`;\n    }\n    else if (summary.overallCompatibility >= 70) {\n        report += `⚠️ 專案存在一些相容性問題，建議加入必要的 polyfill。\\n`;\n    }\n    else {\n        report += `❌ 專案存在較多相容性問題，建議仔細評估目標瀏覽器需求或加入 polyfill。\\n`;\n    }\n    if (polyfillRecommendations.length > 0) {\n        report += `\\n建議加入 ${polyfillRecommendations.length} 個 polyfill 以提升相容性。\\n`;\n    }\n    return report;\n}\n/**\n * 建立 GitHub Flavored Markdown 表格（在 GitHub 評論中正確顯示）\n */\nfunction createAsciiTable(headers, rows) {\n    // 轉義表格中的管道符號，避免破壞表格結構\n    const escapeCell = (cell) => {\n        return cell.replace(/\\|/g, '\\\\|').replace(/\\n/g, ' ');\n    };\n    // 建立表頭\n    const headerRow = '| ' + headers.map(escapeCell).join(' | ') + ' |';\n    // 建立分隔線（GitHub Markdown 表格需要至少 3 個破折號）\n    const separator = '| ' + headers.map(() => '---').join(' | ') + ' |';\n    // 建立資料行\n    const dataRows = rows.map(row => {\n        return '| ' + row.map(cell => escapeCell(cell || '')).join(' | ') + ' |';\n    });\n    // 組合表格\n    let table = '\\n';\n    table += headerRow + '\\n';\n    table += separator + '\\n';\n    table += dataRows.join('\\n') + '\\n';\n    table += '\\n';\n    return table;\n}\n/**\n * 格式化問題表格\n */\nfunction formatIssueTable(issues) {\n    const headers = ['API', '全球支援率', '不支援的瀏覽器', 'Polyfill'];\n    const rows = issues.map(issue => {\n        const browsers = issue.unsupportedBrowsers.slice(0, 3).join(', ') || '-';\n        const more = issue.unsupportedBrowsers.length > 3 ? ` (+${issue.unsupportedBrowsers.length - 3})` : '';\n        const polyfill = issue.polyfillAvailable ? '✅ 可用' : '❌ 無';\n        return [issue.api, `${issue.globalSupport.toFixed(1)}%`, `${browsers}${more}`, polyfill];\n    });\n    return createAsciiTable(headers, rows) + '\\n';\n}\n/**\n * 格式化為純文字\n */\nfunction formatAsText(analysis) {\n    const { summary, targetBrowsers, issues, polyfillRecommendations } = analysis;\n    let report = `API 相容性分析報告\\n`;\n    report += `${'='.repeat(50)}\\n\\n`;\n    report += `執行摘要\\n`;\n    report += `-`.repeat(30) + '\\n';\n    report += `分析的 API: ${summary.totalApisAnalyzed}\\n`;\n    report += `完全相容: ${summary.compatibleApis}\\n`;\n    report += `不相容: ${summary.incompatibleApis}\\n`;\n    report += `整體相容性: ${summary.overallCompatibility}%\\n\\n`;\n    report += `目標瀏覽器\\n`;\n    report += `-`.repeat(30) + '\\n';\n    for (const browser of targetBrowsers) {\n        report += `- ${BROWSER_NAME_MAP[browser.name] || browser.name} ${browser.version}\\n`;\n    }\n    report += '\\n';\n    if (issues.length > 0) {\n        report += `相容性問題 (${issues.length})\\n`;\n        report += `-`.repeat(30) + '\\n';\n        for (const issue of issues) {\n            report += `[${issue.severity.toUpperCase()}] ${issue.api}\\n`;\n            report += `  不支援: ${issue.unsupportedBrowsers.join(', ')}\\n`;\n            report += `  Polyfill: ${issue.polyfillAvailable ? '可用' : '無'}\\n\\n`;\n        }\n    }\n    return report;\n}\n/**\n * 格式化為 HTML\n */\nfunction formatAsHtml(analysis) {\n    const { summary, targetBrowsers, issues, polyfillRecommendations } = analysis;\n    return `<!DOCTYPE html>\n<html lang=\"zh-TW\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>API 相容性分析報告</title>\n  <style>\n    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; max-width: 900px; margin: 0 auto; padding: 20px; }\n    h1 { color: #333; }\n    .summary { background: #f5f5f5; padding: 20px; border-radius: 8px; margin: 20px 0; }\n    .summary-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; }\n    .stat { text-align: center; }\n    .stat-value { font-size: 2em; font-weight: bold; color: #2563eb; }\n    .stat-label { color: #666; }\n    table { width: 100%; border-collapse: collapse; margin: 15px 0; }\n    th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }\n    th { background: #f0f0f0; }\n    .critical { background: #fee2e2; }\n    .high { background: #fef3c7; }\n    .medium { background: #fef9c3; }\n    .low { background: #dcfce7; }\n    code { background: #e5e7eb; padding: 2px 6px; border-radius: 4px; }\n  </style>\n</head>\n<body>\n  <h1>🔍 API 相容性分析報告</h1>\n  \n  <div class=\"summary\">\n    <h2>執行摘要</h2>\n    <div class=\"summary-grid\">\n      <div class=\"stat\">\n        <div class=\"stat-value\">${summary.totalApisAnalyzed}</div>\n        <div class=\"stat-label\">分析的 API</div>\n      </div>\n      <div class=\"stat\">\n        <div class=\"stat-value\" style=\"color: ${summary.overallCompatibility >= 80 ? '#16a34a' : '#dc2626'}\">${summary.overallCompatibility}%</div>\n        <div class=\"stat-label\">整體相容性</div>\n      </div>\n      <div class=\"stat\">\n        <div class=\"stat-value\">${summary.polyfillsNeeded}</div>\n        <div class=\"stat-label\">需要 Polyfill</div>\n      </div>\n    </div>\n  </div>\n\n  <h2>目標瀏覽器</h2>\n  <table>\n    <tr><th>瀏覽器</th><th>最低版本</th></tr>\n    ${targetBrowsers.map(b => `<tr><td>${BROWSER_NAME_MAP[b.name] || b.name}</td><td>${b.version}</td></tr>`).join('')}\n  </table>\n\n  ${issues.length > 0 ? `\n  <h2>相容性問題</h2>\n  <table>\n    <tr><th>API</th><th>嚴重程度</th><th>不支援的瀏覽器</th><th>Polyfill</th></tr>\n    ${issues.map(i => `<tr class=\"${i.severity}\"><td><code>${i.api}</code></td><td>${i.severity}</td><td>${i.unsupportedBrowsers.join(', ')}</td><td>${i.polyfillAvailable ? '✅' : '❌'}</td></tr>`).join('')}\n  </table>\n  ` : '<h2>✅ 無相容性問題</h2>'}\n\n</body>\n</html>`;\n}\n//# sourceMappingURL=compatibility.js.map","import { parse } from '@typescript-eslint/parser';\nimport { glob } from 'glob';\nimport { readFileSync, existsSync } from 'fs';\nimport { resolve, extname } from 'path';\n/**\n * TypeScript/JavaScript 程式碼解析器\n */\nexport class CodeParser {\n    supportedExtensions = ['.js', '.jsx', '.ts', '.tsx', '.mjs', '.cjs'];\n    /**\n     * 解析專案中的所有支援的檔案\n     */\n    async parseProject(projectPath, includePatterns = ['**/*.{js,ts,jsx,tsx}'], excludePatterns = ['node_modules/**', 'dist/**', 'build/**']) {\n        const files = await this.findFiles(projectPath, includePatterns, excludePatterns);\n        const results = [];\n        for (const file of files) {\n            try {\n                const parsed = await this.parseFile(file);\n                if (parsed) {\n                    results.push(parsed);\n                }\n            }\n            catch (error) {\n                console.warn(`無法解析檔案 ${file}:`, error instanceof Error ? error.message : error);\n            }\n        }\n        return results;\n    }\n    /**\n     * 解析單一檔案\n     */\n    async parseFile(filePath) {\n        if (!existsSync(filePath)) {\n            throw new Error(`檔案不存在: ${filePath}`);\n        }\n        const ext = extname(filePath);\n        if (!this.supportedExtensions.includes(ext)) {\n            return null;\n        }\n        const content = readFileSync(filePath, 'utf-8');\n        return this.parseCode(content, filePath);\n    }\n    /**\n     * 解析程式碼字串\n     */\n    parseCode(code, filePath) {\n        try {\n            // 使用 TypeScript ESLint Parser 解析\n            const ast = parse(code, {\n                ecmaVersion: 'latest',\n                sourceType: 'module',\n                ecmaFeatures: {\n                    jsx: true,\n                    globalReturn: false\n                },\n                loc: true,\n                range: true,\n                comment: true,\n                attachComments: true\n            });\n            // 分析 AST 提取資訊\n            const imports = this.extractImports(ast);\n            const exports = this.extractExports(ast);\n            const functions = this.extractFunctions(ast);\n            const apiCalls = this.extractApiCalls(ast);\n            const dependencies = this.extractDependencies(imports);\n            return {\n                filePath: filePath || '<unknown>',\n                ast,\n                imports,\n                exports,\n                functions,\n                apiCalls,\n                dependencies\n            };\n        }\n        catch (error) {\n            throw new Error(`解析失敗: ${error instanceof Error ? error.message : String(error)}`);\n        }\n    }\n    /**\n     * 搜尋檔案\n     */\n    async findFiles(projectPath, includePatterns, excludePatterns) {\n        const files = [];\n        for (const pattern of includePatterns) {\n            try {\n                const matches = await glob(pattern, {\n                    cwd: resolve(projectPath),\n                    ignore: excludePatterns,\n                    absolute: true\n                });\n                files.push(...matches);\n            }\n            catch (error) {\n                console.warn(`搜尋模式 ${pattern} 失敗:`, error);\n            }\n        }\n        // 去重並排序\n        return [...new Set(files)].sort();\n    }\n    /**\n     * 提取 import 語句資訊 (支援 ES Module 和 CommonJS)\n     */\n    extractImports(ast) {\n        const imports = [];\n        this.traverseAST(ast, (node) => {\n            // ES Module: import ... from '...'\n            if (node.type === 'ImportDeclaration') {\n                const source = node.source?.value;\n                if (!source)\n                    return;\n                const specifiers = (node.specifiers || []).map((spec) => {\n                    if (spec.type === 'ImportDefaultSpecifier') {\n                        return {\n                            imported: 'default',\n                            local: spec.local?.name || '',\n                            type: 'default'\n                        };\n                    }\n                    else if (spec.type === 'ImportNamespaceSpecifier') {\n                        return {\n                            imported: '*',\n                            local: spec.local?.name || '',\n                            type: 'namespace'\n                        };\n                    }\n                    else if (spec.type === 'ImportSpecifier') {\n                        return {\n                            imported: spec.imported?.name || '',\n                            local: spec.local?.name || '',\n                            type: 'named'\n                        };\n                    }\n                    return null;\n                }).filter(Boolean);\n                imports.push({\n                    source,\n                    specifiers,\n                    isTypeOnly: node.importKind === 'type',\n                    loc: node.loc ? { line: node.loc.start.line, column: node.loc.start.column } : undefined\n                });\n            }\n            // CommonJS: require('...')\n            if (node.type === 'CallExpression' &&\n                node.callee?.type === 'Identifier' &&\n                node.callee.name === 'require' &&\n                node.arguments?.[0]?.type === 'Literal' &&\n                typeof node.arguments[0].value === 'string') {\n                const source = node.arguments[0].value;\n                let specifiers = [];\n                // 檢查 require 的使用方式\n                // 1. const x = require('...') - default import\n                // 2. const { a, b } = require('...') - named imports\n                // 3. require('...') - side effect import\n                // 找到父節點來判斷使用方式\n                const parent = this.findParentNode(ast, node);\n                if (parent?.type === 'VariableDeclarator') {\n                    const id = parent.id;\n                    // const { a, b } = require('...')\n                    if (id?.type === 'ObjectPattern') {\n                        specifiers = (id.properties || [])\n                            .filter((prop) => prop.type === 'Property')\n                            .map((prop) => ({\n                            imported: prop.key?.name || prop.key?.value || '',\n                            local: prop.value?.name || prop.key?.name || '',\n                            type: 'named'\n                        }));\n                    }\n                    // const x = require('...')\n                    else if (id?.type === 'Identifier') {\n                        specifiers = [{\n                                imported: 'default',\n                                local: id.name,\n                                type: 'default'\n                            }];\n                    }\n                }\n                // 避免重複添加 (同一位置的 require)\n                const existingImport = imports.find(imp => imp.source === source &&\n                    imp.loc?.line === node.loc?.start?.line);\n                if (!existingImport) {\n                    imports.push({\n                        source,\n                        specifiers,\n                        isTypeOnly: false,\n                        loc: node.loc ? { line: node.loc.start.line, column: node.loc.start.column } : undefined\n                    });\n                }\n            }\n        });\n        return imports;\n    }\n    /**\n     * 找到指定節點的父節點\n     */\n    findParentNode(ast, targetNode) {\n        let parent = null;\n        const search = (node, parentNode) => {\n            if (node === targetNode) {\n                parent = parentNode;\n                return true;\n            }\n            for (const key in node) {\n                const child = node[key];\n                if (child && typeof child === 'object') {\n                    if (Array.isArray(child)) {\n                        for (const item of child) {\n                            if (item && typeof item === 'object' && item.type) {\n                                if (search(item, node))\n                                    return true;\n                            }\n                        }\n                    }\n                    else if (child.type) {\n                        if (search(child, node))\n                            return true;\n                    }\n                }\n            }\n            return false;\n        };\n        search(ast, null);\n        return parent;\n    }\n    /**\n     * 提取 export 語句資訊\n     */\n    extractExports(ast) {\n        const exports = [];\n        this.traverseAST(ast, (node) => {\n            if (node.type === 'ExportDefaultDeclaration') {\n                exports.push({\n                    name: 'default',\n                    type: 'default',\n                    loc: node.loc ? { line: node.loc.start.line, column: node.loc.start.column } : undefined\n                });\n            }\n            else if (node.type === 'ExportNamedDeclaration') {\n                if (node.declaration) {\n                    // export function/class/variable\n                    const name = node.declaration.id?.name || node.declaration.name;\n                    if (name) {\n                        exports.push({\n                            name,\n                            type: 'named',\n                            loc: node.loc ? { line: node.loc.start.line, column: node.loc.start.column } : undefined\n                        });\n                    }\n                }\n                else if (node.specifiers) {\n                    // export { ... }\n                    for (const spec of node.specifiers) {\n                        if (spec.type === 'ExportSpecifier') {\n                            exports.push({\n                                name: spec.exported?.name || '',\n                                type: 'named',\n                                loc: node.loc ? { line: node.loc.start.line, column: node.loc.start.column } : undefined\n                            });\n                        }\n                    }\n                }\n            }\n        });\n        return exports;\n    }\n    /**\n     * 提取函式資訊\n     */\n    extractFunctions(ast) {\n        const functions = [];\n        this.traverseAST(ast, (node) => {\n            if (node.type === 'FunctionDeclaration' || node.type === 'FunctionExpression') {\n                const name = node.id?.name || '<anonymous>';\n                const parameters = (node.params || []).map((param) => param.name || param.type);\n                functions.push({\n                    name,\n                    parameters,\n                    isAsync: node.async === true,\n                    isArrow: false,\n                    loc: node.loc ? { line: node.loc.start.line, column: node.loc.start.column } : undefined\n                });\n            }\n            else if (node.type === 'ArrowFunctionExpression') {\n                const parameters = (node.params || []).map((param) => param.name || param.type);\n                functions.push({\n                    name: '<arrow>',\n                    parameters,\n                    isAsync: node.async === true,\n                    isArrow: true,\n                    loc: node.loc ? { line: node.loc.start.line, column: node.loc.start.column } : undefined\n                });\n            }\n        });\n        return functions;\n    }\n    /**\n     * 提取 API 呼叫資訊\n     */\n    extractApiCalls(ast) {\n        const apiCalls = [];\n        this.traverseAST(ast, (node) => {\n            if (node.type === 'CallExpression') {\n                let api = '';\n                let method;\n                if (node.callee.type === 'Identifier') {\n                    // 函式呼叫: func()\n                    api = node.callee.name;\n                }\n                else if (node.callee.type === 'MemberExpression') {\n                    // 方法呼叫: obj.method()\n                    const object = this.getNodeName(node.callee.object);\n                    const property = this.getNodeName(node.callee.property);\n                    api = object;\n                    method = property;\n                }\n                if (api) {\n                    apiCalls.push({\n                        api,\n                        method,\n                        arguments: (node.arguments || []).map((arg) => this.getNodeValue(arg)),\n                        loc: node.loc ? { line: node.loc.start.line, column: node.loc.start.column } : undefined\n                    });\n                }\n            }\n        });\n        return apiCalls;\n    }\n    /**\n     * 提取依賴項目\n     */\n    extractDependencies(imports) {\n        const deps = new Set();\n        for (const imp of imports) {\n            // 只收集外部依賴 (不是相對路徑)\n            if (!imp.source.startsWith('.') && !imp.source.startsWith('/')) {\n                // 處理 scoped packages (如 @types/node)\n                const parts = imp.source.split('/');\n                if (parts[0].startsWith('@')) {\n                    deps.add(`${parts[0]}/${parts[1]}`);\n                }\n                else {\n                    deps.add(parts[0]);\n                }\n            }\n        }\n        return Array.from(deps).sort();\n    }\n    /**\n     * 遍歷 AST\n     */\n    traverseAST(node, visitor) {\n        visitor(node);\n        for (const key in node) {\n            const child = node[key];\n            if (child && typeof child === 'object') {\n                if (Array.isArray(child)) {\n                    for (const item of child) {\n                        if (item && typeof item === 'object' && item.type) {\n                            this.traverseAST(item, visitor);\n                        }\n                    }\n                }\n                else if (child.type) {\n                    this.traverseAST(child, visitor);\n                }\n            }\n        }\n    }\n    /**\n     * 取得節點名稱\n     */\n    getNodeName(node) {\n        if (!node)\n            return '';\n        switch (node.type) {\n            case 'Identifier':\n                return node.name || '';\n            case 'MemberExpression':\n                const obj = this.getNodeName(node.object);\n                const prop = this.getNodeName(node.property);\n                return obj && prop ? `${obj}.${prop}` : '';\n            case 'ThisExpression':\n                return 'this';\n            default:\n                return node.type;\n        }\n    }\n    /**\n     * 取得節點值\n     */\n    getNodeValue(node) {\n        if (!node)\n            return null;\n        switch (node.type) {\n            case 'Literal':\n                return node.value;\n            case 'Identifier':\n                return node.name;\n            case 'ArrayExpression':\n                return (node.elements || []).map((el) => this.getNodeValue(el));\n            case 'ObjectExpression':\n                const obj = {};\n                for (const prop of node.properties || []) {\n                    if (prop.type === 'Property') {\n                        const key = this.getNodeValue(prop.key);\n                        const value = this.getNodeValue(prop.value);\n                        obj[key] = value;\n                    }\n                }\n                return obj;\n            default:\n                return `<${node.type}>`;\n        }\n    }\n}\n//# sourceMappingURL=index.js.map","/**\n * 報告生成器\n */\nexport class ReportFormatter {\n    /**\n     * 格式化現代化分析報告\n     */\n    formatModernizationReport(analysis, format = 'markdown') {\n        switch (format) {\n            case 'markdown':\n                return this.formatMarkdownReport(analysis);\n            case 'json':\n                return this.formatJsonReport(analysis);\n            case 'html':\n                return this.formatHtmlReport(analysis);\n            case 'text':\n                return this.formatTextReport(analysis);\n            default:\n                throw new Error(`不支援的格式: ${format}`);\n        }\n    }\n    /**\n     * 格式化為 Markdown 報告\n     */\n    formatMarkdownReport(analysis) {\n        const { summary, suggestions, fileAnalysis, riskAssessment } = analysis;\n        let report = '# 程式碼現代化分析報告\\n\\n';\n        // 執行摘要\n        report += '## 📊 執行摘要\\n\\n';\n        report += `- **掃描檔案數量**: ${summary.totalFiles} 個檔案\\n`;\n        report += `- **發現建議數量**: ${summary.totalSuggestions} 項\\n`;\n        report += `- **潛在效能提升**: ${summary.potentialPerformanceGain}%\\n`;\n        report += `- **檔案大小減少**: ${summary.bundleSizeReduction}KB\\n\\n`;\n        // 風險評估\n        report += '## ⚠️ 風險評估\\n\\n';\n        report += `- **整體風險等級**: ${this.getRiskIcon(riskAssessment.overallRisk)} ${riskAssessment.overallRisk.toUpperCase()}\\n`;\n        report += `- **預估工時**: ${riskAssessment.migrationEffort.estimatedHours} 小時\\n`;\n        report += `- **複雜度**: ${riskAssessment.migrationEffort.complexity.toUpperCase()}\\n`;\n        report += `- **優先順序**: ${riskAssessment.migrationEffort.priority.toUpperCase()}\\n\\n`;\n        if (riskAssessment.breakingChanges.length > 0) {\n            report += '### 💥 破壞性變更警告\\n\\n';\n            for (const change of riskAssessment.breakingChanges) {\n                report += `- **${change.type}**: ${change.description}\\n`;\n                report += `  - 影響等級: ${change.impact.toUpperCase()}\\n`;\n                report += `  - 緩解方案: ${change.mitigation}\\n\\n`;\n            }\n        }\n        // 現代化建議摘要\n        if (suggestions.length > 0) {\n            report += '## 🚀 主要現代化建議\\n\\n';\n            // 按類型分組建議\n            const groupedSuggestions = this.groupSuggestionsByType(suggestions);\n            for (const [type, typeSuggestions] of groupedSuggestions) {\n                report += `### ${this.getTypeIcon(type)} ${this.getTypeDisplayName(type)}\\n\\n`;\n                for (const suggestion of typeSuggestions.slice(0, 5)) { // 只顯示前 5 個\n                    report += `#### ${suggestion.title}\\n`;\n                    report += `${suggestion.description}\\n\\n`;\n                    report += '**目前程式碼:**\\n';\n                    report += '```javascript\\n';\n                    report += suggestion.currentCode;\n                    report += '\\n```\\n\\n';\n                    report += '**現代化版本:**\\n';\n                    report += '```javascript\\n';\n                    report += suggestion.modernCode;\n                    report += '\\n```\\n\\n';\n                    report += `- 💪 **效能提升**: ${suggestion.impact?.performance || 0}%\\n`;\n                    report += `- 📦 **檔案減少**: ${suggestion.impact?.bundle || 0}KB\\n`;\n                    report += `- 🛠️ **維護性**: ${suggestion.impact?.maintainability || 0}/5\\n`;\n                    report += `- ⚡ **實作難度**: ${suggestion.difficulty.toUpperCase()}\\n`;\n                    report += `- 💥 **破壞性變更**: ${suggestion.breaking ? '是' : '否'}\\n\\n`;\n                    if (suggestion.location) {\n                        report += `📍 位置: 第 ${suggestion.location.line} 行\\n\\n`;\n                    }\n                    report += '---\\n\\n';\n                }\n                if (typeSuggestions.length > 5) {\n                    report += `*以及其他 ${typeSuggestions.length - 5} 項 ${this.getTypeDisplayName(type)} 建議...*\\n\\n`;\n                }\n            }\n        }\n        // 檔案詳細分析\n        if (fileAnalysis.length > 0) {\n            report += '## 📁 檔案詳細分析\\n\\n';\n            // 只顯示有建議的檔案，並限制數量\n            const filesWithSuggestions = fileAnalysis\n                .filter(file => file.suggestions.length > 0)\n                .slice(0, 10); // 只顯示前 10 個檔案\n            for (const file of filesWithSuggestions) {\n                report += `### 📄 ${file.filePath}\\n`;\n                report += `發現 ${file.suggestions.length} 項現代化機會\\n\\n`;\n                // 顯示該檔案的建議摘要\n                const topSuggestions = file.suggestions.slice(0, 3);\n                for (const suggestion of topSuggestions) {\n                    report += `- **${suggestion.title}** (難度: ${suggestion.difficulty})\\n`;\n                }\n                if (file.suggestions.length > 3) {\n                    report += `- *以及其他 ${file.suggestions.length - 3} 項建議...*\\n`;\n                }\n                report += '\\n';\n            }\n            if (fileAnalysis.filter(f => f.suggestions.length > 0).length > 10) {\n                const remaining = fileAnalysis.filter(f => f.suggestions.length > 0).length - 10;\n                report += `*以及其他 ${remaining} 個檔案有現代化機會...*\\n\\n`;\n            }\n        }\n        // 實作建議\n        report += '## 📋 實作建議\\n\\n';\n        report += '### 優先順序建議\\n\\n';\n        const highPriority = suggestions.filter(s => (s.impact?.performance || 0) > 15 ||\n            (s.impact?.bundle || 0) > 30 ||\n            s.type === 'library-replacement');\n        if (highPriority.length > 0) {\n            report += '#### 🔥 高優先順序 (建議立即處理)\\n';\n            for (const suggestion of highPriority.slice(0, 5)) {\n                report += `- ${suggestion.title}\\n`;\n            }\n            report += '\\n';\n        }\n        const lowRisk = suggestions.filter(s => !s.breaking && s.difficulty === 'trivial');\n        if (lowRisk.length > 0) {\n            report += '#### ✅ 低風險快速改善 (可先處理)\\n';\n            for (const suggestion of lowRisk.slice(0, 5)) {\n                report += `- ${suggestion.title}\\n`;\n            }\n            report += '\\n';\n        }\n        // 結論\n        report += '## 🎯 結論\\n\\n';\n        if (summary.totalSuggestions === 0) {\n            report += '🎉 恭喜！您的程式碼已經相當現代化，沒有發現需要立即處理的現代化機會。\\n\\n';\n        }\n        else if (riskAssessment.overallRisk === 'low') {\n            report += '✨ 您的程式碼有不錯的現代化潛力，且風險相對較低。建議逐步實施這些改善。\\n\\n';\n        }\n        else {\n            report += '⚡ 發現多項現代化機會，建議制定詳細的移轉計畫，優先處理高影響、低風險的項目。\\n\\n';\n        }\n        report += `總計可能節省 ${summary.bundleSizeReduction}KB 檔案大小，提升 ${summary.potentialPerformanceGain}% 效能。\\n\\n`;\n        report += '---\\n';\n        report += '*此報告由 [@mukiwu/dev-advisor-mcp](https://github.com/mukiwu/dev-advisor-mcp) 自動生成*\\n';\n        return report;\n    }\n    /**\n     * 格式化為 JSON 報告\n     */\n    formatJsonReport(analysis) {\n        return JSON.stringify(analysis, null, 2);\n    }\n    /**\n     * 格式化為 HTML 報告\n     */\n    formatHtmlReport(analysis) {\n        const { summary, suggestions, riskAssessment } = analysis;\n        let html = `\n<!DOCTYPE html>\n<html lang=\"zh-TW\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>程式碼現代化分析報告</title>\n    <style>\n        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; line-height: 1.6; margin: 40px; }\n        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 10px; margin-bottom: 30px; }\n        .summary { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }\n        .metric { background: #f8f9fa; padding: 20px; border-radius: 8px; text-align: center; }\n        .metric-value { font-size: 2em; font-weight: bold; color: #2c3e50; }\n        .suggestion { background: white; border: 1px solid #e1e5e9; border-radius: 8px; padding: 20px; margin-bottom: 20px; }\n        .code-block { background: #f6f8fa; border: 1px solid #e1e5e9; border-radius: 6px; padding: 16px; margin: 10px 0; overflow-x: auto; }\n        .risk-high { color: #dc3545; }\n        .risk-medium { color: #ffc107; }\n        .risk-low { color: #28a745; }\n    </style>\n</head>\n<body>\n    <div class=\"header\">\n        <h1>🚀 程式碼現代化分析報告</h1>\n        <p>智慧分析您的程式碼，發現現代化機會</p>\n    </div>\n\n    <div class=\"summary\">\n        <div class=\"metric\">\n            <div class=\"metric-value\">${summary.totalFiles}</div>\n            <div>掃描檔案</div>\n        </div>\n        <div class=\"metric\">\n            <div class=\"metric-value\">${summary.totalSuggestions}</div>\n            <div>現代化建議</div>\n        </div>\n        <div class=\"metric\">\n            <div class=\"metric-value\">${summary.potentialPerformanceGain}%</div>\n            <div>效能提升</div>\n        </div>\n        <div class=\"metric\">\n            <div class=\"metric-value\">${summary.bundleSizeReduction}KB</div>\n            <div>檔案減少</div>\n        </div>\n    </div>\n\n    <h2>⚠️ 風險評估</h2>\n    <p class=\"risk-${riskAssessment.overallRisk}\">\n        整體風險等級: <strong>${riskAssessment.overallRisk.toUpperCase()}</strong>\n    </p>\n    <p>預估工時: ${riskAssessment.migrationEffort.estimatedHours} 小時</p>\n`;\n        if (suggestions.length > 0) {\n            html += '<h2>🎯 主要建議</h2>';\n            for (const suggestion of suggestions.slice(0, 10)) {\n                html += `\n        <div class=\"suggestion\">\n            <h3>${suggestion.title}</h3>\n            <p>${suggestion.description}</p>\n\n            <h4>目前程式碼:</h4>\n            <div class=\"code-block\"><pre><code>${this.escapeHtml(suggestion.currentCode)}</code></pre></div>\n\n            <h4>現代化版本:</h4>\n            <div class=\"code-block\"><pre><code>${this.escapeHtml(suggestion.modernCode)}</code></pre></div>\n\n            <div style=\"display: flex; gap: 20px; margin-top: 15px;\">\n                <span>💪 效能: +${suggestion.impact?.performance || 0}%</span>\n                <span>📦 檔案: -${suggestion.impact?.bundle || 0}KB</span>\n                <span>⚡ 難度: ${suggestion.difficulty}</span>\n                <span>💥 破壞性: ${suggestion.breaking ? '是' : '否'}</span>\n            </div>\n        </div>`;\n            }\n        }\n        html += `\n    <footer style=\"margin-top: 50px; padding-top: 20px; border-top: 1px solid #e1e5e9; color: #6c757d; text-align: center;\">\n        此報告由 [@mukiwu/dev-advisor-mcp](https://github.com/mukiwu/dev-advisor-mcp) 自動生成\n    </footer>\n</body>\n</html>`;\n        return html;\n    }\n    /**\n     * 格式化為純文字報告\n     */\n    formatTextReport(analysis) {\n        const { summary, suggestions, riskAssessment } = analysis;\n        let report = '程式碼現代化分析報告\\n';\n        report += '='.repeat(50) + '\\n\\n';\n        report += '執行摘要:\\n';\n        report += `---------\\n`;\n        report += `掃描檔案數量: ${summary.totalFiles}\\n`;\n        report += `現代化建議: ${summary.totalSuggestions}\\n`;\n        report += `潜在效能提升: ${summary.potentialPerformanceGain}%\\n`;\n        report += `檔案大小減少: ${summary.bundleSizeReduction}KB\\n\\n`;\n        report += `風險評估: ${riskAssessment.overallRisk.toUpperCase()}\\n`;\n        report += `預估工時: ${riskAssessment.migrationEffort.estimatedHours} 小時\\n\\n`;\n        if (suggestions.length > 0) {\n            report += '主要建議:\\n';\n            report += '---------\\n';\n            for (const suggestion of suggestions.slice(0, 5)) {\n                report += `${suggestion.title}\\n`;\n                report += `${suggestion.description}\\n`;\n                report += `難度: ${suggestion.difficulty}, 破壞性: ${suggestion.breaking ? '是' : '否'}\\n`;\n                report += '-'.repeat(40) + '\\n';\n            }\n        }\n        return report;\n    }\n    /**\n     * 按類型分組建議\n     */\n    groupSuggestionsByType(suggestions) {\n        const groups = new Map();\n        for (const suggestion of suggestions) {\n            const type = suggestion.type;\n            if (!groups.has(type)) {\n                groups.set(type, []);\n            }\n            groups.get(type).push(suggestion);\n        }\n        // 按優先順序排序類型\n        const sortedGroups = new Map();\n        const typeOrder = ['library-replacement', 'api-modernization', 'syntax-modernization', 'pattern-modernization'];\n        for (const type of typeOrder) {\n            if (groups.has(type)) {\n                sortedGroups.set(type, groups.get(type));\n            }\n        }\n        return sortedGroups;\n    }\n    /**\n     * 取得類型圖示\n     */\n    getTypeIcon(type) {\n        const icons = {\n            'library-replacement': '📚',\n            'api-modernization': '🔄',\n            'syntax-modernization': '✨',\n            'pattern-modernization': '🎨'\n        };\n        return icons[type] || '🔧';\n    }\n    /**\n     * 取得類型顯示名稱\n     */\n    getTypeDisplayName(type) {\n        const names = {\n            'library-replacement': '函式庫替換',\n            'api-modernization': 'API 現代化',\n            'syntax-modernization': '語法現代化',\n            'pattern-modernization': '模式現代化'\n        };\n        return names[type] || type;\n    }\n    /**\n     * 取得風險圖示\n     */\n    getRiskIcon(risk) {\n        const icons = {\n            'low': '🟢',\n            'medium': '🟡',\n            'high': '🔴'\n        };\n        return icons[risk] || '⚪';\n    }\n    /**\n     * HTML 轉義\n     * 將特殊字元轉換為 HTML entities，防止 XSS 攻擊\n     */\n    escapeHtml(text) {\n        if (!text)\n            return '';\n        return text\n            .replace(/&/g, '&amp;')\n            .replace(/</g, '&lt;')\n            .replace(/>/g, '&gt;')\n            .replace(/\"/g, '&quot;')\n            .replace(/'/g, '&#039;');\n    }\n}\n//# sourceMappingURL=report-formatter.js.map","/**\n * Can I Use API 服務\n * 動態查詢瀏覽器相容性資料\n */\n/**\n * Can I Use 服務\n */\nexport class CanIUseService {\n    // 官方 Can I Use GitHub 資料來源（主要）\n    dataUrls = [\n        'https://raw.githubusercontent.com/Fyrd/caniuse/main/data.json',\n        'https://cdn.jsdelivr.net/npm/caniuse-db@latest/data.json',\n        'https://raw.githubusercontent.com/nicxvan/caniuse/main/fulldata-json/data-2.0.json'\n    ];\n    cachedData = null;\n    cacheTime = 0;\n    cacheDuration = 24 * 60 * 60 * 1000; // 24 小時\n    /**\n     * 載入 Can I Use 資料（支援 fallback）\n     */\n    async loadData() {\n        // 檢查快取\n        if (this.cachedData && Date.now() - this.cacheTime < this.cacheDuration) {\n            return this.cachedData;\n        }\n        let lastError = null;\n        // 嘗試所有資料來源\n        for (const url of this.dataUrls) {\n            try {\n                const response = await fetch(url, {\n                    headers: {\n                        'Accept': 'application/json',\n                        'User-Agent': 'DevAdvisor-MCP/1.0'\n                    }\n                });\n                if (!response.ok) {\n                    lastError = new Error(`Can I Use 資料載入失敗: ${response.status} (${url})`);\n                    continue;\n                }\n                this.cachedData = await response.json();\n                this.cacheTime = Date.now();\n                return this.cachedData;\n            }\n            catch (error) {\n                lastError = error;\n                console.warn(`嘗試載入 ${url} 失敗，嘗試下一個來源...`);\n            }\n        }\n        // 所有來源都失敗\n        console.error('所有 Can I Use 資料來源都載入失敗:', lastError);\n        throw new Error(`Can I Use 資料載入失敗: 所有資料來源都無法存取`);\n    }\n    /**\n     * 搜尋功能\n     */\n    async searchFeature(query) {\n        const data = await this.loadData();\n        const features = data.data || {};\n        const lowerQuery = query.toLowerCase();\n        const matches = [];\n        for (const [id, feature] of Object.entries(features)) {\n            let score = 0;\n            // 完全匹配 ID\n            if (id.toLowerCase() === lowerQuery) {\n                score = 100;\n            }\n            // ID 包含查詢\n            else if (id.toLowerCase().includes(lowerQuery)) {\n                score = 80;\n            }\n            // 標題匹配\n            else if (feature.title?.toLowerCase().includes(lowerQuery)) {\n                score = 60;\n            }\n            // 描述匹配\n            else if (feature.description?.toLowerCase().includes(lowerQuery)) {\n                score = 40;\n            }\n            // 關鍵字匹配\n            else if (feature.keywords?.toLowerCase().includes(lowerQuery)) {\n                score = 30;\n            }\n            if (score > 0) {\n                matches.push({ id, score });\n            }\n        }\n        // 按分數排序並返回 ID\n        return matches\n            .sort((a, b) => b.score - a.score)\n            .slice(0, 10)\n            .map(m => m.id);\n    }\n    /**\n     * 取得功能的瀏覽器支援資料\n     */\n    async getFeatureSupport(featureId) {\n        const data = await this.loadData();\n        const feature = data.data?.[featureId];\n        if (!feature) {\n            // 嘗試搜尋\n            const matches = await this.searchFeature(featureId);\n            if (matches.length > 0) {\n                return this.getFeatureSupport(matches[0]);\n            }\n            return null;\n        }\n        const browsers = data.agents || {};\n        return {\n            featureId,\n            title: feature.title || featureId,\n            description: feature.description || '',\n            status: feature.status || 'other',\n            usage: this.calculateGlobalUsage(feature, browsers),\n            categories: feature.categories || [],\n            browsers: this.parseBrowserSupport(feature.stats, browsers),\n            notes: this.parseNotes(feature.notes_by_num),\n            links: feature.links?.map((l) => ({ url: l.url, title: l.title })),\n            mdnUrl: feature.mdn_url,\n            specUrl: feature.spec\n        };\n    }\n    /**\n     * 計算全球使用率\n     */\n    calculateGlobalUsage(feature, browsers) {\n        // 簡化計算：基於主要瀏覽器的支援狀況\n        const stats = feature.stats || {};\n        let supportedUsage = 0;\n        const majorBrowsers = ['chrome', 'firefox', 'safari', 'edge'];\n        for (const browser of majorBrowsers) {\n            const browserStats = stats[browser] || {};\n            const latestVersion = Object.keys(browserStats).pop();\n            if (latestVersion) {\n                const support = browserStats[latestVersion];\n                if (support?.startsWith('y') || support === 'y') {\n                    supportedUsage += 25; // 每個主要瀏覽器約 25%\n                }\n                else if (support?.startsWith('a')) {\n                    supportedUsage += 15;\n                }\n            }\n        }\n        return Math.min(supportedUsage, 100);\n    }\n    /**\n     * 解析瀏覽器支援資料\n     */\n    parseBrowserSupport(stats, browsers) {\n        const browserList = ['chrome', 'firefox', 'safari', 'edge', 'ie', 'opera', 'ios_saf', 'android', 'samsung'];\n        const result = {};\n        for (const browser of browserList) {\n            const browserStats = stats?.[browser] || {};\n            const versions = Object.entries(browserStats);\n            // 找到第一個支援的版本\n            let sinceVersion;\n            let currentSupport = 'n';\n            let hasPartialSupport = false;\n            for (const [version, support] of versions) {\n                if (support.startsWith('y') && !sinceVersion) {\n                    sinceVersion = version;\n                }\n                if (support.startsWith('a')) {\n                    hasPartialSupport = true;\n                }\n            }\n            // 取得最新版本的支援狀態\n            const latestVersion = versions[versions.length - 1];\n            if (latestVersion) {\n                const [, support] = latestVersion;\n                currentSupport = support.charAt(0) || 'u';\n            }\n            result[browser] = {\n                supported: currentSupport === 'y' || currentSupport === 'a',\n                partialSupport: hasPartialSupport || currentSupport === 'a',\n                sinceVersion,\n                currentSupport\n            };\n        }\n        return result;\n    }\n    /**\n     * 解析備註\n     */\n    parseNotes(notesByNum) {\n        if (!notesByNum)\n            return undefined;\n        return Object.values(notesByNum).slice(0, 5);\n    }\n    /**\n     * 檢查 API 在目標瀏覽器中的相容性\n     */\n    async checkCompatibility(featureId, targetBrowsers = {\n        chrome: '90',\n        firefox: '88',\n        safari: '14',\n        edge: '90'\n    }) {\n        const support = await this.getFeatureSupport(featureId);\n        if (!support) {\n            return {\n                feature: featureId,\n                globalSupport: 0,\n                supported: [],\n                notSupported: Object.keys(targetBrowsers),\n                partialSupport: [],\n                recommendation: `找不到 ${featureId} 的相容性資料，建議查詢 MDN 文件`,\n                polyfillAvailable: false\n            };\n        }\n        const supported = [];\n        const notSupported = [];\n        const partialSupport = [];\n        for (const [browser, targetVersion] of Object.entries(targetBrowsers)) {\n            const browserSupport = support.browsers[browser];\n            if (!browserSupport) {\n                notSupported.push(browser);\n                continue;\n            }\n            if (browserSupport.supported) {\n                if (browserSupport.sinceVersion) {\n                    const sinceNum = parseFloat(browserSupport.sinceVersion);\n                    const targetNum = parseFloat(targetVersion);\n                    if (sinceNum <= targetNum) {\n                        if (browserSupport.partialSupport) {\n                            partialSupport.push(`${browser} >= ${browserSupport.sinceVersion}`);\n                        }\n                        else {\n                            supported.push(`${browser} >= ${browserSupport.sinceVersion}`);\n                        }\n                    }\n                    else {\n                        notSupported.push(`${browser} < ${browserSupport.sinceVersion}`);\n                    }\n                }\n                else {\n                    supported.push(browser);\n                }\n            }\n            else {\n                notSupported.push(browser);\n            }\n        }\n        // 生成建議\n        let recommendation = '';\n        if (notSupported.length === 0) {\n            recommendation = '✅ 所有目標瀏覽器都支援此功能';\n        }\n        else if (supported.length === 0) {\n            recommendation = '❌ 此功能在目標瀏覽器中不受支援，需要 polyfill 或替代方案';\n        }\n        else {\n            recommendation = `⚠️ 部分瀏覽器不支援：${notSupported.join(', ')}。建議提供 fallback 或使用 polyfill`;\n        }\n        return {\n            feature: support.title,\n            globalSupport: support.usage,\n            supported,\n            notSupported,\n            partialSupport,\n            recommendation,\n            polyfillAvailable: this.checkPolyfillAvailable(featureId),\n            polyfillUrl: this.getPolyfillUrl(featureId)\n        };\n    }\n    /**\n     * 檢查是否有 polyfill\n     */\n    checkPolyfillAvailable(featureId) {\n        const polyfillableFeatures = [\n            'fetch', 'promise', 'array-includes', 'object-assign',\n            'string-includes', 'array-find', 'array-from', 'symbol',\n            'map', 'set', 'weakmap', 'weakset', 'proxy', 'reflect',\n            'intersectionobserver', 'resizeobserver', 'mutationobserver',\n            'customelements', 'shadowdom', 'template', 'dialog'\n        ];\n        return polyfillableFeatures.some(f => featureId.toLowerCase().includes(f));\n    }\n    /**\n     * 取得 polyfill URL\n     */\n    getPolyfillUrl(featureId) {\n        // polyfill.io 服務\n        const polyfillIoFeatures = {\n            'fetch': 'fetch',\n            'promise': 'Promise',\n            'array-includes': 'Array.prototype.includes',\n            'object-assign': 'Object.assign',\n            'string-includes': 'String.prototype.includes',\n            'array-find': 'Array.prototype.find',\n            'array-from': 'Array.from',\n            'symbol': 'Symbol',\n            'map': 'Map',\n            'set': 'Set',\n            'weakmap': 'WeakMap',\n            'weakset': 'WeakSet',\n            'intersectionobserver': 'IntersectionObserver',\n            'resizeobserver': 'ResizeObserver',\n        };\n        for (const [key, polyfillName] of Object.entries(polyfillIoFeatures)) {\n            if (featureId.toLowerCase().includes(key)) {\n                return `https://polyfill.io/v3/polyfill.min.js?features=${polyfillName}`;\n            }\n        }\n        return undefined;\n    }\n    /**\n     * 批次檢查多個功能的相容性\n     */\n    async checkMultipleFeatures(featureIds, targetBrowsers) {\n        const reports = [];\n        for (const featureId of featureIds) {\n            const report = await this.checkCompatibility(featureId, targetBrowsers);\n            reports.push(report);\n        }\n        return reports;\n    }\n    /**\n     * 取得特定類別的功能列表\n     */\n    async getFeaturesByCategory(category) {\n        const data = await this.loadData();\n        const features = data.data || {};\n        const matches = [];\n        const lowerCategory = category.toLowerCase();\n        for (const [id, feature] of Object.entries(features)) {\n            const categories = feature.categories || [];\n            if (categories.some((c) => c.toLowerCase().includes(lowerCategory))) {\n                matches.push(id);\n            }\n        }\n        return matches;\n    }\n}\n/**\n * API 名稱到 Can I Use ID 的映射\n * 用於從常見的 API 呼叫名稱查詢對應的 caniuse feature ID\n */\nexport const API_NAME_TO_CANIUSE = {\n    // Fetch & Network\n    'fetch': 'fetch',\n    'AbortController': 'abortcontroller',\n    'Headers': 'fetch',\n    'Request': 'fetch',\n    'Response': 'fetch',\n    // DOM APIs\n    'querySelector': 'queryselector',\n    'querySelectorAll': 'queryselector',\n    'classList': 'classlist',\n    'MutationObserver': 'mutationobserver',\n    'IntersectionObserver': 'intersectionobserver',\n    'ResizeObserver': 'resizeobserver',\n    // Storage\n    'localStorage': 'namevalue-storage',\n    'sessionStorage': 'namevalue-storage',\n    'indexedDB': 'indexeddb',\n    'IndexedDB': 'indexeddb',\n    // Media\n    'getUserMedia': 'stream',\n    'MediaRecorder': 'mediarecorder',\n    'AudioContext': 'audio-api',\n    // Graphics\n    'canvas': 'canvas',\n    'getContext': 'canvas',\n    'WebGL': 'webgl',\n    'WebGL2': 'webgl2',\n    // Async\n    'Promise': 'promises',\n    'Worker': 'webworkers',\n    'SharedWorker': 'sharedworkers',\n    'ServiceWorker': 'serviceworkers',\n    // URL\n    'URL': 'url',\n    'URLSearchParams': 'urlsearchparams',\n    // Events\n    'CustomEvent': 'customevent',\n    'BroadcastChannel': 'broadcastchannel',\n    'WebSocket': 'websockets',\n    'EventSource': 'eventsource',\n    // File\n    'FileReader': 'fileapi',\n    'Blob': 'blobbuilder',\n    'File': 'fileapi',\n    // Location & Notification\n    'geolocation': 'geolocation',\n    'Notification': 'notifications',\n    // Intl\n    'Intl.DateTimeFormat': 'internationalization',\n    'Intl.NumberFormat': 'internationalization',\n    // Crypto\n    'crypto.randomUUID': 'mdn-api_crypto_randomuuid',\n    'crypto.subtle': 'cryptography',\n    // Animation\n    'requestAnimationFrame': 'requestanimationframe',\n    'animate': 'web-animation',\n    // ES6+\n    'Proxy': 'proxy',\n    'Symbol': 'es6',\n    'Map': 'es6',\n    'Set': 'es6',\n    'WeakMap': 'es6',\n    'WeakSet': 'es6',\n    'Array.from': 'array-from',\n    'Array.includes': 'array-includes',\n    'Object.assign': 'object-assign',\n    'Object.entries': 'object-entries',\n    'Object.values': 'object-values',\n    'String.padStart': 'pad-start-end',\n    'String.padEnd': 'pad-start-end',\n    'Array.flat': 'array-flat',\n    'Array.flatMap': 'array-flat',\n    'BigInt': 'bigint',\n};\n/**\n * 從 API 名稱取得 Can I Use ID\n */\nexport function getCaniuseIdFromApiName(apiName) {\n    // 直接匹配\n    if (API_NAME_TO_CANIUSE[apiName]) {\n        return API_NAME_TO_CANIUSE[apiName];\n    }\n    // 嘗試匹配部分名稱\n    for (const [key, value] of Object.entries(API_NAME_TO_CANIUSE)) {\n        if (apiName.includes(key) || key.includes(apiName)) {\n            return value;\n        }\n    }\n    return null;\n}\n/**\n * 建立 Can I Use 服務實例\n */\nexport function createCanIUseService() {\n    return new CanIUseService();\n}\n//# sourceMappingURL=caniuse-service.js.map","\n/**\n * 分析執行器\n * 直接調用分析器類別，不依賴 MCP 協議\n */\n\nimport { ModernizationAnalyzer } from '../dist/src/analyzers/modernization.js';\nimport { CompatibilityAnalyzer, formatCompatibilityReport } from '../dist/src/analyzers/compatibility.js';\nimport { CodeParser } from '../dist/src/parsers/index.js';\nimport { ReportFormatter } from '../dist/src/utils/report-formatter.js';\nimport { CanIUseService } from '../dist/src/services/caniuse-service.js';\n\n/**\n * 執行現代化分析\n */\nexport async function runModernizationAnalysis(projectPath, includePatterns, excludePatterns) {\n  const parser = new CodeParser();\n  const analyzer = new ModernizationAnalyzer(parser);\n  const formatter = new ReportFormatter();\n\n  const analysis = await analyzer.analyze(projectPath, includePatterns, excludePatterns);\n  const report = formatter.formatModernizationReport(analysis, 'markdown');\n\n  return {\n    analysis,\n    report,\n    summary: {\n      totalFiles: analysis.summary.totalFiles,\n      totalSuggestions: analysis.summary.totalSuggestions,\n      performanceGain: analysis.summary.potentialPerformanceGain,\n      bundleReduction: analysis.summary.bundleSizeReduction,\n      risk: analysis.riskAssessment.overallRisk\n    }\n  };\n}\n\n/**\n * 執行相容性分析\n */\nexport async function runCompatibilityAnalysis(projectPath, includePatterns, excludePatterns, browserslistConfig) {\n  const parser = new CodeParser();\n  const canIUseService = new CanIUseService();\n  const analyzer = new CompatibilityAnalyzer(parser, canIUseService);\n\n  const analysis = await analyzer.analyze(\n    projectPath,\n    includePatterns,\n    excludePatterns,\n    browserslistConfig || undefined\n  );\n\n  const report = formatCompatibilityReport(analysis, 'markdown');\n\n  return {\n    analysis,\n    report,\n    summary: {\n      totalApis: analysis.summary.totalApisAnalyzed,\n      compatibleApis: analysis.summary.compatibleApis,\n      incompatibleApis: analysis.summary.incompatibleApis,\n      overallCompatibility: analysis.summary.overallCompatibility,\n      polyfillsNeeded: analysis.summary.polyfillsNeeded\n    }\n  };\n}\n\n/**\n * 執行所有分析\n */\nexport async function runAllAnalyses(options) {\n  const {\n    projectPath,\n    includePatterns,\n    excludePatterns,\n    browserslistConfig,\n    enableModernization,\n    enableCompatibility\n  } = options;\n\n  const results = {\n    modernization: null,\n    compatibility: null,\n    errors: []\n  };\n\n  // 執行現代化分析\n  if (enableModernization) {\n    try {\n      results.modernization = await runModernizationAnalysis(\n        projectPath,\n        includePatterns,\n        excludePatterns\n      );\n    } catch (error) {\n      results.errors.push({\n        type: 'modernization',\n        error: error instanceof Error ? error.message : String(error)\n      });\n    }\n  }\n\n  // 執行相容性分析\n  if (enableCompatibility) {\n    try {\n      results.compatibility = await runCompatibilityAnalysis(\n        projectPath,\n        includePatterns,\n        excludePatterns,\n        browserslistConfig\n      );\n    } catch (error) {\n      results.errors.push({\n        type: 'compatibility',\n        error: error instanceof Error ? error.message : String(error)\n      });\n    }\n  }\n\n  return results;\n}\n\n"],"names":[],"sourceRoot":""}